<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="Nate Liu&#39;s Blog">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Nate Liu&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Nate Liu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Nate Liu's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Nate Liu's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Nate Liu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/nateliu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;nateliu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jinliangliu@163.com" title="E-Mail → mailto:jinliangliu@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/28/npm-with-pubish-business/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/28/npm-with-pubish-business/" class="post-title-link" itemprop="url">news-pubish-management(6)--publish business</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-28 11:46:42" itemprop="dateCreated datePublished" datetime="2021-12-28T11:46:42+00:00">2021-12-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1-create-a-new-component"><a href="#1-create-a-new-component" class="headerlink" title="1, create a new component"></a>1, create a new component</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir src/components/publish-manage</span><br><span class="line">touch src/components/publish-manage/NewsPublish.js</span><br></pre></td></tr></table></figure>
<p>copy RightList.js to NewsPublish.js, modify content as below.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsPublish</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻标题&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">title, item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#/<span class="attr">news-manage</span>/<span class="attr">preview</span>/$&#123;<span class="attr">item.id</span>&#125;`&#125;&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;作者&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;author&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻分类&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">category</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;category.title&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;props.dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; /&gt;;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>so the Unpublish.js looks like</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NewsPublish <span class="keyword">from</span> <span class="string">&#x27;../../../components/publish-manage/NewsPublish&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Unpublished</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([])</span><br><span class="line">    <span class="keyword">const</span> &#123; username &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?author=<span class="subst">$&#123;username&#125;</span>&amp;publishState=1&amp;_expand=category`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [username]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NewsPublish</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">NewsPublish</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-Define-a-custom-hook"><a href="#2-Define-a-custom-hook" class="headerlink" title="2. Define a custom hook"></a>2. Define a custom hook</h3><p>Because <code>Published.js</code> and <code>Sunset.js</code> are similar to <code>Unpublish.js</code>, only the publishState is difference. So we can define a custom hook.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch src/components/publish-manage/usePublish.js</span><br></pre></td></tr></table></figure>
<p>content is cut from Unpublish.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; notification &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">usePublish</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([])</span><br><span class="line">    <span class="keyword">const</span> &#123; username &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?author=<span class="subst">$&#123;username&#125;</span>&amp;publishState=<span class="subst">$&#123;type&#125;</span>&amp;_expand=category`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setDataSource(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [username, type]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handlePublish = <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(id);</span></span><br><span class="line">        setDataSource(dataSource.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.id !== id));</span><br><span class="line"></span><br><span class="line">        axios.patch(<span class="string">`/api/news/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">publishStats</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">publishTime</span>: <span class="built_in">Date</span>.now(),</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            notification.info(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">`Notification`</span>,</span><br><span class="line">                <span class="attr">description</span>:</span><br><span class="line">                    <span class="string">`Please go to published box for reviewing your news`</span>,</span><br><span class="line">                <span class="attr">placement</span>: <span class="string">&#x27;bottomRight&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleSunset = <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">        setDataSource(dataSource.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.id !== id));</span><br><span class="line">        axios.patch(<span class="string">`/api/news/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">publishStats</span>: <span class="number">3</span>,</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            notification.info(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">`Notification`</span>,</span><br><span class="line">                <span class="attr">description</span>:</span><br><span class="line">                    <span class="string">`Please go to Sunset box for reviewing your news`</span>,</span><br><span class="line">                <span class="attr">placement</span>: <span class="string">&#x27;bottomRight&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleDelete = <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">        setDataSource(dataSource.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.id !== id));</span><br><span class="line"></span><br><span class="line">        axios.delete(<span class="string">`/api/news/<span class="subst">$&#123;id&#125;</span>`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            notification.info(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">`Notification`</span>,</span><br><span class="line">                <span class="attr">description</span>:</span><br><span class="line">                    <span class="string">`Your news was deleted`</span>,</span><br><span class="line">                <span class="attr">placement</span>: <span class="string">&#x27;bottomRight&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        dataSource,</span><br><span class="line">        handlePublish,</span><br><span class="line">        handleSunset,</span><br><span class="line">        handleDelete,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>So the Unpublished.js change to </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> NewsPublish <span class="keyword">from</span> <span class="string">&#x27;../../../components/publish-manage/NewsPublish&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> usePublish <span class="keyword">from</span> <span class="string">&#x27;../../../components/publish-manage/usePublish&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Unpublished</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1 unpublished</span></span><br><span class="line">    <span class="comment">// 2 published</span></span><br><span class="line">    <span class="comment">// 3 sunset</span></span><br><span class="line">    <span class="keyword">const</span> &#123; dataSource, handlePublish &#125; = usePublish(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">NewsPublish</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">button</span>=<span class="string">&#123;id</span> =&gt;</span> <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handlePublish(id)&#125;&gt;发布<span class="tag">&lt;/<span class="name">Button</span>&gt;</span>&#125;&gt;<span class="tag">&lt;/<span class="name">NewsPublish</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>and the NewsPublish.js change to</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsPublish</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻标题&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">title, item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#/<span class="attr">news-manage</span>/<span class="attr">preview</span>/$&#123;<span class="attr">item.id</span>&#125;`&#125;&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;作者&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;author&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻分类&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">category</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;category.title&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;props.button(item.id)&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;props.dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; /&gt;;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>according the type, easy to peform Published.js and Sunset.js</p>
<blockquote>
<p>Custom hook is important!</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/27/npm-with-audit-business/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/27/npm-with-audit-business/" class="post-title-link" itemprop="url">news-pubish-management(5)--audit business</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-27 20:37:52" itemprop="dateCreated datePublished" datetime="2021-12-27T20:37:52+00:00">2021-12-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>The audit list should be showing date the user ownself, audiState should not equals to 0 and publishState should less than 1.</p>
<h3 id="1-Get-back-data-in-AuditList-js"><a href="#1-Get-back-data-in-AuditList-js" class="headerlink" title="1. Get back data in AuditList.js"></a>1. Get back data in <code>AuditList.js</code></h3><p>copy from RightList.js and mofify as below</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table, Tag &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">AuditList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻标题&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">title, item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#/<span class="attr">news-manage</span>/<span class="attr">preview</span>/$&#123;<span class="attr">item.id</span>&#125;`&#125;&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻分类&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">category</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> category.title</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;作者&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;author&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;审核状态&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;auditState&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">auditState</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> colorList = [<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;red&#x27;</span>];</span><br><span class="line">                <span class="keyword">const</span> auditList = [<span class="string">&#x27;未审核&#x27;</span>, <span class="string">&#x27;审核中&#x27;</span>, <span class="string">&#x27;已通过&#x27;</span>, <span class="string">&#x27;未通过&#x27;</span>];</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Tag</span> <span class="attr">color</span>=<span class="string">&#123;colorList[auditState]&#125;</span>&gt;</span>&#123;auditList[auditState]&#125;<span class="tag">&lt;/<span class="name">Tag</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        item.auditState === 1 &amp;&amp; <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span>&gt;</span>撤销<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        item.auditState === 2 &amp;&amp; <span class="tag">&lt;<span class="name">Button</span>&gt;</span>发布<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        item.auditState === 3 &amp;&amp; <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?_expand=category&amp;author=<span class="subst">$&#123;username&#125;</span>&amp;auditState_ne=0&amp;publishState_lte=1`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setDataSource(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [username]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; /&gt;;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> auditList = [<span class="string">&#x27;未审核&#x27;</span>, <span class="string">&#x27;审核中&#x27;</span>, <span class="string">&#x27;已通过&#x27;</span>, <span class="string">&#x27;未通过&#x27;</span>];</span><br></pre></td></tr></table></figure>
<p>you wan to revert from audit. it is easy, change the auditState from 2 to 0.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleRevert = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    setDataSource(dataSource.filter(<span class="function"><span class="params">data</span>=&gt;</span>data.id!==item.id));</span><br><span class="line">    </span><br><span class="line">    axios.patch(<span class="string">`/api/news/<span class="subst">$&#123;item.id&#125;</span>`</span>, &#123;</span><br><span class="line">        <span class="attr">auditStats</span>: <span class="number">0</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        navigate(<span class="string">&#x27;/news-manage/draft&#x27;</span>);</span><br><span class="line">        notification.info(&#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">`Notification`</span>,</span><br><span class="line">            <span class="attr">description</span>:</span><br><span class="line">                <span class="string">`Please go to draft box for reviewing your news`</span>,</span><br><span class="line">            <span class="attr">placement</span>: <span class="string">&#x27;bottomRight&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>update is easy, useNavigate to NewsUpdate.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleUpdate = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    navigate(<span class="string">`/news-manage/update/<span class="subst">$&#123;item.id&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>publish news, change the publishState from 1 to 2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handlePublish = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    axios.patch(<span class="string">`/api/news/<span class="subst">$&#123;item.id&#125;</span>`</span>, &#123;</span><br><span class="line">        <span class="attr">publishStats</span>: <span class="number">2</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        navigate(<span class="string">&#x27;/publish-manage/published&#x27;</span>);</span><br><span class="line">        notification.info(&#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">`Notification`</span>,</span><br><span class="line">            <span class="attr">description</span>:</span><br><span class="line">                <span class="string">`Please go to published box for reviewing your news`</span>,</span><br><span class="line">            <span class="attr">placement</span>: <span class="string">&#x27;bottomRight&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Audit-news"><a href="#2-Audit-news" class="headerlink" title="2. Audit news"></a>2. Audit news</h3><p>copy from AuditList.js and modify as below</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Table, Button &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useNavigate &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Audit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; roleId, region, username &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻标题&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">title, item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#/<span class="attr">news-manage</span>/<span class="attr">preview</span>/$&#123;<span class="attr">item.id</span>&#125;`&#125;&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻分类&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">category</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> category.title</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;作者&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;author&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span>&gt;</span>通过<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> &gt;</span>驳回<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> roleObj = &#123;</span><br><span class="line">            <span class="string">&quot;1&quot;</span>: <span class="string">&quot;superadmin&quot;</span>,</span><br><span class="line">            <span class="string">&quot;2&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">            <span class="string">&quot;3&quot;</span>: <span class="string">&quot;editor&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        axios.get(<span class="string">`/api/news?auditState=1&amp;_expand=category`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res.data);</span><br><span class="line">            <span class="keyword">const</span> list = res.data;</span><br><span class="line">            setDataSource(roleObj[roleId] === <span class="string">&#x27;superadmin&#x27;</span> ? list : [</span><br><span class="line">                ...list.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.username === username),</span><br><span class="line">                ...list.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.region === region &amp;&amp; roleObj[item.roleId] === <span class="string">&#x27;editor&#x27;</span>)</span><br><span class="line">            ]);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, [roleId, region, username]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; /&gt;;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Audit &amp; Reject<br>audit change the auditState from 1 to 2, publishState change to 1,<br>reject change the auditState from 1 to 3, publishState change to 0</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleAudit = <span class="function">(<span class="params">item, auditState, publishState</span>) =&gt;</span> &#123;</span><br><span class="line">    setDataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id));</span><br><span class="line"></span><br><span class="line">    axios.patch(<span class="string">`/api/news/<span class="subst">$&#123;item.id&#125;</span>`</span>, &#123;</span><br><span class="line">        auditState,</span><br><span class="line">        publishState</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Add-NewsCategory"><a href="#3-Add-NewsCategory" class="headerlink" title="3. Add NewsCategory"></a>3. Add NewsCategory</h3><p>copy RightList.js and modify it as below:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table, Modal &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    DeleteOutlined,</span><br><span class="line">    ExclamationCircleOutlined,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; confirm &#125; = Modal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsCategory</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;id&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;分类名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; onClick=&#123;() =&gt; confirmDelete(item)&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmDelete = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Do you Want to delete this item?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">// console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                realDelete(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;Cancel&#x27;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> realDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item);</span></span><br><span class="line">        setDataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id));</span><br><span class="line">        axios.delete(<span class="string">`/api/categories/<span class="subst">$&#123;item.id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/categories`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setDataSource(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; /&gt;;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>use table <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/table/#components-table-demo-edit-cell">Table EditCell</a> for editing title</p>
<p>add components proeprty in Table, the components nees EditableRow and EditableCell, it is complex to read this document but need careful, at the end the NewsCategory should be looks like</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table, Modal, Form, Input &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    DeleteOutlined,</span><br><span class="line">    ExclamationCircleOutlined,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useContext, useState, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; confirm &#125; = Modal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsCategory</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> EditableContext = React.createContext(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;id&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;分类名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">            <span class="attr">onCell</span>: <span class="function">(<span class="params">record</span>) =&gt;</span> (&#123;</span><br><span class="line">                record,</span><br><span class="line">                <span class="attr">editable</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;分类名称&#x27;</span>,</span><br><span class="line">                <span class="attr">handleSave</span>: handleCellSave,</span><br><span class="line">            &#125;),</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; onClick=&#123;() =&gt; confirmDelete(item)&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleCellSave = <span class="function"><span class="params">record</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(record);</span></span><br><span class="line">        setDataSource(dataSource.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.id === record.id) &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="attr">id</span>: item.id,</span><br><span class="line">                    <span class="attr">title</span>: record.title,</span><br><span class="line">                    <span class="attr">value</span>: record.title,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">        axios.patch(<span class="string">`/api/categories/<span class="subst">$&#123;record.id&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">title</span>: record.title,</span><br><span class="line">            <span class="attr">value</span>: record.title,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmDelete = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Do you Want to delete this item?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">// console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                realDelete(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;Cancel&#x27;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> realDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item);</span></span><br><span class="line">        setDataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id));</span><br><span class="line">        axios.delete(<span class="string">`/api/categories/<span class="subst">$&#123;item.id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/categories`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setDataSource(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> EditableRow = <span class="function">(<span class="params">&#123; index, ...props &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> [form] = Form.useForm();</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">form</span>=<span class="string">&#123;form&#125;</span> <span class="attr">component</span>=<span class="string">&#123;false&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">EditableContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;form&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">tr</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">EditableContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> EditableCell = <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        title,</span></span></span><br><span class="line"><span class="params"><span class="function">        editable,</span></span></span><br><span class="line"><span class="params"><span class="function">        children,</span></span></span><br><span class="line"><span class="params"><span class="function">        dataIndex,</span></span></span><br><span class="line"><span class="params"><span class="function">        record,</span></span></span><br><span class="line"><span class="params"><span class="function">        handleSave,</span></span></span><br><span class="line"><span class="params"><span class="function">        ...restProps</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> [editing, setEditing] = useState(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">const</span> inputRef = useRef(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">const</span> form = useContext(EditableContext);</span><br><span class="line">        useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (editing) &#123;</span><br><span class="line">                inputRef.current.focus();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, [editing]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> toggleEdit = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            setEditing(!editing);</span><br><span class="line">            form.setFieldsValue(&#123;</span><br><span class="line">                [dataIndex]: record[dataIndex],</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> save = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> values = <span class="keyword">await</span> form.validateFields();</span><br><span class="line">                toggleEdit();</span><br><span class="line">                handleSave(&#123; ...record, ...values &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (errInfo) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;Save failed:&#x27;</span>, errInfo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> childNode = children;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (editable) &#123;</span><br><span class="line">            childNode = editing ? (</span><br><span class="line">                <span class="xml"><span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">margin:</span> <span class="attr">0</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">name</span>=<span class="string">&#123;dataIndex&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        &#123;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">message:</span> `$&#123;<span class="attr">title</span>&#125; <span class="attr">is</span> <span class="attr">required.</span>`,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                        &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                &gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> <span class="attr">onPressEnter</span>=<span class="string">&#123;save&#125;</span> <span class="attr">onBlur</span>=<span class="string">&#123;save&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line">            ) : (</span><br><span class="line">                <span class="xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">className</span>=<span class="string">&quot;editable-cell-value-wrap&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">paddingRight:</span> <span class="attr">24</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onClick</span>=<span class="string">&#123;toggleEdit&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                &gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;children&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">td</span> &#123;<span class="attr">...restProps</span>&#125;&gt;</span>&#123;childNode&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; components=&#123;&#123;</span></span><br><span class="line"><span class="xml">                body: &#123;</span></span><br><span class="line"><span class="xml">                    row: EditableRow,</span></span><br><span class="line"><span class="xml">                    cell: EditableCell,</span></span><br><span class="line"><span class="xml">                &#125;,</span></span><br><span class="line"><span class="xml">            &#125;&#125; /&gt;;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/27/npm-with-news-business/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/27/npm-with-news-business/" class="post-title-link" itemprop="url">news-pubish-management(4)--news business</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-27 12:41:52" itemprop="dateCreated datePublished" datetime="2021-12-27T12:41:52+00:00">2021-12-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>We have finished the permission, let’s back to focus the busines of publish news.</p>
<h3 id="1-performing-the-src-views-sandbox-news-manage-NewsAdd-js"><a href="#1-performing-the-src-views-sandbox-news-manage-NewsAdd-js" class="headerlink" title="1. performing the src/views/sandbox/news-manage/NewsAdd.js"></a>1. performing the <span style="color:lightblue">src/views/sandbox/news-manage/NewsAdd.js</span></h3><p>use <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/page-header/#components-page-header-demo-basic">Header Basic</a> to perform the title.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PageHeader &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line">...</span><br><span class="line">            &lt;PageHeader</span><br><span class="line">                className=<span class="string">&quot;site-page-header&quot;</span></span><br><span class="line">                onBack=&#123;<span class="function">() =&gt;</span> <span class="literal">null</span>&#125;</span><br><span class="line">                title=<span class="string">&quot;Add news&quot;</span></span><br><span class="line">                subTitle=<span class="string">&quot;This is for adding news&quot;</span></span><br><span class="line">            /&gt;</span><br></pre></td></tr></table></figure>
<p>and we use <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/steps/#components-steps-demo-simple">Step Basic</a> for the progress.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Steps current=&#123;current&#125;&gt;</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Step</span> <span class="attr">title</span>=<span class="string">&quot;基本信息&quot;</span> <span class="attr">description</span>=<span class="string">&quot;新闻标题，新闻分类&quot;</span> /&gt;</span></span></span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Step</span> <span class="attr">title</span>=<span class="string">&quot;新闻内容&quot;</span> <span class="attr">description</span>=<span class="string">&quot;新闻主体内容&quot;</span> /&gt;</span></span></span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Step</span> <span class="attr">title</span>=<span class="string">&quot;新闻提交&quot;</span> <span class="attr">description</span>=<span class="string">&quot;保存草稿或者提交审核&quot;</span> /&gt;</span></span></span><br><span class="line">&lt;/Steps&gt;</span><br></pre></td></tr></table></figure>
<p>chose <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/form/#components-form-demo-basic">Form Basic</a> for the input and select button</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&#123;&#123; <span class="attr">marginTop</span>: <span class="string">&#x27;50px&#x27;</span> &#125;&#125;&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Form</span> &#123;<span class="attr">...layout</span>&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">label</span>=<span class="string">&quot;新闻标题&quot;</span> <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &quot;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">news</span> <span class="attr">title.</span>&quot; &#125;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;categoryId&quot;</span> <span class="attr">label</span>=<span class="string">&quot;新闻分类&quot;</span> <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span> &#125;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;</span></span><br><span class="line"><span class="xml">                    categoryList.map(item =&gt; &#123;</span></span><br><span class="line"><span class="xml">                        return <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#125;)</span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>above we called step 1, next to step 2</p>
<h3 id="2-Add-news-content"><a href="#2-Add-news-content" class="headerlink" title="2. Add news content."></a>2. Add news content.</h3><p>use <a target="_blank" rel="noopener" href="https://github.com/jpuri/react-draft-wysiwyg">react draft editor</a> for edit news content.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-draft-wysiwyg draft-js draftjs-to-html html-to-draftjs</span><br><span class="line">mkdir src/components/news-manage</span><br><span class="line">touch src/components/news-manage/NewsEditor.js</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; convertToRaw &#125; <span class="keyword">from</span> <span class="string">&#x27;draft-js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> draftToHtml <span class="keyword">from</span> <span class="string">&#x27;draftjs-to-html&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Editor &#125; <span class="keyword">from</span> <span class="string">&#x27;react-draft-wysiwyg&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;react-draft-wysiwyg/dist/react-draft-wysiwyg.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsEditor</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [editorState, setEditorState] = useState(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Editor</span> <span class="attr">editorState</span>=<span class="string">&#123;editorState&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">toolbarClassName</span>=<span class="string">&#x27;toolbarClassName&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">wrapperClassName</span>=<span class="string">&#x27;wrapperClassName&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">editorClassName</span>=<span class="string">&#x27;editorClassName&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onEditorStateChange</span>=<span class="string">&#123;editorState</span> =&gt;</span> setEditorState(editorState)&#125;</span></span><br><span class="line"><span class="xml">                onBlur=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="xml">                    console.log(draftToHtml(convertToRaw(editorState.getCurrentContent())))</span></span><br><span class="line"><span class="xml">                &#125;&#125; /&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Add-save-in-progress-3"><a href="#3-Add-save-in-progress-3" class="headerlink" title="3. Add save in progress 3"></a>3. Add save in progress 3</h3><p>use <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/notification/#components-notification-demo-basic">Notification Basic</a> in step 3</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleSave = <span class="function"><span class="params">auditState</span> =&gt;</span> &#123;</span><br><span class="line">       axios.post(<span class="string">&#x27;/api/news&#x27;</span>, &#123;</span><br><span class="line">           ...formInfo,</span><br><span class="line">           <span class="string">&quot;author&quot;</span>: User.username,</span><br><span class="line">           <span class="string">&quot;region&quot;</span>: User.region ? User.region : <span class="string">&#x27;Global&#x27;</span>,</span><br><span class="line">           <span class="string">&quot;roleId&quot;</span>: User.roleId,</span><br><span class="line">           <span class="string">&quot;auditState&quot;</span>: auditState,</span><br><span class="line">           <span class="string">&quot;publishState&quot;</span>: <span class="number">0</span>,</span><br><span class="line">           <span class="string">&quot;content&quot;</span>: content,</span><br><span class="line">           <span class="string">&quot;createTime&quot;</span>: <span class="built_in">Date</span>.now(),</span><br><span class="line">           <span class="string">&quot;star&quot;</span>: <span class="number">0</span>,</span><br><span class="line">           <span class="string">&quot;view&quot;</span>: <span class="number">0</span></span><br><span class="line">       &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">           navigate(auditState === <span class="number">0</span> ? <span class="string">&#x27;/news-manage/draft&#x27;</span> : <span class="string">&#x27;/audit-manage/list&#x27;</span>);</span><br><span class="line">           notification.info(&#123;</span><br><span class="line">               <span class="attr">message</span>: <span class="string">`Notification`</span>,</span><br><span class="line">               <span class="attr">description</span>:</span><br><span class="line">                   <span class="string">`Please go to <span class="subst">$&#123;auditState === <span class="number">0</span> ? <span class="string">&quot;draft box&quot;</span> : <span class="string">&quot;audit box&quot;</span>&#125;</span> for reviewing your news`</span>,</span><br><span class="line">               <span class="attr">placement</span>: <span class="string">&#x27;bottomRight&#x27;</span>,</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-perform-the-draft-box"><a href="#4-perform-the-draft-box" class="headerlink" title="4. perform the draft box"></a>4. perform the draft box</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table, Modal &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    DeleteOutlined,</span><br><span class="line">    EditOutlined,</span><br><span class="line">    ExclamationCircleOutlined,</span><br><span class="line">    UploadOutlined,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; confirm &#125; = Modal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsDraft</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; username &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;id&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻标题&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;新闻分类&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">category</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> category.title</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;作者&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;author&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; onClick=&#123;() =&gt; confirmDelete(item)&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">UploadOutlined</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmDelete = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Do you Want to delete this item?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">// console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                realDelete(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;Cancel&#x27;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> realDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item);</span></span><br><span class="line">        setDataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id));</span><br><span class="line">        axios.delete(<span class="string">`/api/news/<span class="subst">$&#123;item.id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?_expand=category&amp;author=<span class="subst">$&#123;username&#125;</span>&amp;auditState=0`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setDataSource(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [username]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; /&gt;;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>support news preview function.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch src/views/sandbox/news-manage/NewsPreview.js</span><br><span class="line">yarn add moment</span><br></pre></td></tr></table></figure>
<p>moment is used for format DateTime.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PageHeader, Descriptions &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useParams &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsPreview</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [newsInfo, setNewsInfo] = useState(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> params = useParams();</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(props.match.params.id)</span></span><br><span class="line">        axios.get(<span class="string">`/api/news/<span class="subst">$&#123;params.id&#125;</span>?_expand=category&amp;_expand=role`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res.data);</span><br><span class="line">            setNewsInfo(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [params.id]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> auditList = [<span class="string">&#x27;未审核&#x27;</span>, <span class="string">&#x27;审核中&#x27;</span>, <span class="string">&#x27;已通过&#x27;</span>, <span class="string">&#x27;未通过&#x27;</span>];</span><br><span class="line">    <span class="keyword">const</span> publishList = [<span class="string">&#x27;未发布&#x27;</span>, <span class="string">&#x27;待发布&#x27;</span>, <span class="string">&#x27;已发布&#x27;</span>, <span class="string">&#x27;已下线&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        newsInfo &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">PageHeader</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> window.history.back()&#125;</span></span><br><span class="line"><span class="xml">                title=&#123;newsInfo.title&#125;</span></span><br><span class="line"><span class="xml">                subTitle=&#123;newsInfo.category?.title&#125;&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Descriptions</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">column</span>=<span class="string">&#123;3&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;创建者&quot;</span>&gt;</span>&#123;newsInfo.author&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;创建时间&quot;</span>&gt;</span>&#123;moment(newsInfo.createTime).format(&quot;YYYY/MM/DD HH:mm:ss&quot;)&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;发布时间&quot;</span>&gt;</span>&#123;newsInfo.publishTime ? moment(newsInfo.publishTime).format(&quot;YYYY/MM/DD HH:mm:ss&quot;) : &quot;-&quot;&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;区域&quot;</span>&gt;</span>&#123;newsInfo.region&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;审核状态&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> &quot;<span class="attr">red</span>&quot; &#125;&#125;&gt;</span>&#123;auditList[newsInfo.auditState]&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;发布状态&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> &quot;<span class="attr">red</span>&quot; &#125;&#125;&gt;</span>&#123;publishList[newsInfo.publishState]&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;访问数量&quot;</span>&gt;</span>&#123;newsInfo.view&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;点赞数量&quot;</span>&gt;</span>&#123;newsInfo.star&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;评论数量&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Descriptions</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">PageHeader</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">__html:</span> <span class="attr">newsInfo.content</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#125;&#125; <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">margin:</span> &quot;<span class="attr">0</span> <span class="attr">24px</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">border:</span> &quot;<span class="attr">1px</span> <span class="attr">solid</span> <span class="attr">gray</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>support edit news</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch src/views/sandbox/news-manage/NewsUpdate.js</span><br></pre></td></tr></table></figure>
<p>most of code can copy from NewsAdd.js and modify to as below:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PageHeader, Steps, Button, Form, Input, Select, message, notification &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useNavigate, useParams &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> NewsEditor <span class="keyword">from</span> <span class="string">&#x27;../../../components/news-manage/NewsEditor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;./News.module.css&#x27;</span></span><br><span class="line"><span class="keyword">const</span> &#123; Step &#125; = Steps;</span><br><span class="line"><span class="keyword">const</span> &#123; Option &#125; = Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsUpdate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> layout = &#123;</span><br><span class="line">        <span class="attr">labelCol</span>: &#123; <span class="attr">span</span>: <span class="number">4</span> &#125;,</span><br><span class="line">        <span class="attr">wrapperCol</span>: &#123; <span class="attr">span</span>: <span class="number">20</span> &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> User = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [current, setCurrent] = useState(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> [categoryList, setCategoryList] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [formInfo, setFormInfo] = useState(&#123;&#125;);</span><br><span class="line">    <span class="keyword">const</span> [content, setContent] = useState(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newsForm = useRef(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line">    <span class="keyword">const</span> params = useParams();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handlePrevious = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setCurrent(current - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleNext = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (current === <span class="number">0</span>) &#123;</span><br><span class="line">            newsForm.current.validateFields().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// console.log(res);</span></span><br><span class="line">                setFormInfo(res);</span><br><span class="line">                setCurrent(current + <span class="number">1</span>);</span><br><span class="line">            &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(formInfo,content);</span></span><br><span class="line">            <span class="keyword">if</span> (content === <span class="string">&#x27;&#x27;</span> || content.trim() === <span class="string">&#x27;&lt;p&gt;&lt;/p&gt;&#x27;</span>) &#123;</span><br><span class="line">                message.error(<span class="string">`News content can not be empty!`</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                setCurrent(current + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleSave = <span class="function"><span class="params">auditState</span> =&gt;</span> &#123;</span><br><span class="line">        axios.patch(<span class="string">`/api/news/<span class="subst">$&#123;params.id&#125;</span>`</span>, &#123;</span><br><span class="line">            ...formInfo,</span><br><span class="line">            <span class="string">&quot;auditState&quot;</span>: auditState,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: content,</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            navigate(auditState === <span class="number">0</span> ? <span class="string">&#x27;/news-manage/draft&#x27;</span> : <span class="string">&#x27;/audit-manage/list&#x27;</span>);</span><br><span class="line">            notification.info(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">`Notification`</span>,</span><br><span class="line">                <span class="attr">description</span>:</span><br><span class="line">                    <span class="string">`Please go to <span class="subst">$&#123;auditState === <span class="number">0</span> ? <span class="string">&quot;draft box&quot;</span> : <span class="string">&quot;audit box&quot;</span>&#125;</span> for reviewing your news`</span>,</span><br><span class="line">                <span class="attr">placement</span>: <span class="string">&#x27;bottomRight&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/categories`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setCategoryList(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(props.match.params.id)</span></span><br><span class="line">        axios.get(<span class="string">`/api/news/<span class="subst">$&#123;params.id&#125;</span>?_expand=category&amp;_expand=role`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            <span class="comment">// setNewsInfo(res.data);</span></span><br><span class="line">            <span class="comment">// content</span></span><br><span class="line">            <span class="comment">// formInfo</span></span><br><span class="line">            <span class="keyword">const</span> &#123; title, categoryId, content &#125; = res.data;</span><br><span class="line"></span><br><span class="line">            newsForm.current.setFieldsValue(&#123;</span><br><span class="line">                title,</span><br><span class="line">                categoryId</span><br><span class="line">            &#125;);</span><br><span class="line">            setContent(content);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [params.id]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">PageHeader</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">className</span>=<span class="string">&quot;site-page-header&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> navigate(&#x27;/news-manage/draft&#x27;)&#125;</span></span><br><span class="line"><span class="xml">                title=&quot;Update news&quot;</span></span><br><span class="line"><span class="xml">                subTitle=&quot;This is for update news&quot;</span></span><br><span class="line"><span class="xml">            /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Steps</span> <span class="attr">current</span>=<span class="string">&#123;current&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Step</span> <span class="attr">title</span>=<span class="string">&quot;基本信息&quot;</span> <span class="attr">description</span>=<span class="string">&quot;新闻标题，新闻分类&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Step</span> <span class="attr">title</span>=<span class="string">&quot;新闻内容&quot;</span> <span class="attr">description</span>=<span class="string">&quot;新闻主体内容&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Step</span> <span class="attr">title</span>=<span class="string">&quot;新闻提交&quot;</span> <span class="attr">description</span>=<span class="string">&quot;保存草稿或者提交审核&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Steps</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginTop:</span> &#x27;<span class="attr">50px</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;current</span> === <span class="string">0</span> ? &#x27;&#x27; <span class="attr">:</span> <span class="attr">style.active</span>&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Form</span> &#123;<span class="attr">...layout</span>&#125; <span class="attr">name</span>=<span class="string">&#x27;basic&#x27;</span> <span class="attr">ref</span>=<span class="string">&#123;newsForm&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">label</span>=<span class="string">&quot;新闻标题&quot;</span> <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &quot;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">news</span> <span class="attr">title.</span>&quot; &#125;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Form.Item</span> <span class="attr">name</span>=<span class="string">&quot;categoryId&quot;</span> <span class="attr">label</span>=<span class="string">&quot;新闻分类&quot;</span> <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span> &#125;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                &#123;</span></span><br><span class="line"><span class="xml">                                    categoryList.map(item =&gt; &#123;</span></span><br><span class="line"><span class="xml">                                        return <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    &#125;)</span></span><br><span class="line"><span class="xml">                                &#125;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;current</span> === <span class="string">1</span> ? &#x27;&#x27; <span class="attr">:</span> <span class="attr">style.active</span>&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">NewsEditor</span> <span class="attr">getContent</span>=<span class="string">&#123;value</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                    // console.log(value);</span></span><br><span class="line"><span class="xml">                    setContent(value);</span></span><br><span class="line"><span class="xml">                &#125;&#125; content=&#123;content&#125;&gt;<span class="tag">&lt;/<span class="name">NewsEditor</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;current</span> === <span class="string">2</span> ? &#x27;&#x27; <span class="attr">:</span> <span class="attr">style.active</span>&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginTop:</span> &#x27;<span class="attr">50px</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;current &gt; 0 &amp;&amp; <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;handlePrevious&#125;</span>&gt;</span> 上一步<span class="tag">&lt;/<span class="name">Button</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                &#123;current &lt; 2 &amp;&amp; <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;handleNext&#125;</span>&gt;</span> 下一步<span class="tag">&lt;/<span class="name">Button</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                &#123;</span></span><br><span class="line"><span class="xml">                    current === 2 &amp;&amp; <span class="tag">&lt;<span class="name">sapn</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleSave(0)&#125;&gt;保存草稿箱<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleSave(1)&#125;&gt;提交审核<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">sapn</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>and the NewsEditor looks like below</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ContentState, convertToRaw, EditorState &#125; <span class="keyword">from</span> <span class="string">&#x27;draft-js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> draftToHtml <span class="keyword">from</span> <span class="string">&#x27;draftjs-to-html&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> htmlToDraft <span class="keyword">from</span> <span class="string">&#x27;html-to-draftjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Editor &#125; <span class="keyword">from</span> <span class="string">&#x27;react-draft-wysiwyg&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;react-draft-wysiwyg/dist/react-draft-wysiwyg.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsEditor</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [editorState, setEditorState] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(props.content);</span></span><br><span class="line">        <span class="keyword">const</span> html = props.content;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (html === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> contentBlock = htmlToDraft(html);</span><br><span class="line">        <span class="keyword">if</span> (contentBlock) &#123;</span><br><span class="line">            <span class="keyword">const</span> contentState = ContentState.createFromBlockArray(contentBlock.contentBlocks);</span><br><span class="line">            <span class="keyword">const</span> editorState = EditorState.createWithContent(contentState);</span><br><span class="line">            setEditorState(editorState);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [props.content]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Editor</span> <span class="attr">editorState</span>=<span class="string">&#123;editorState&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">toolbarClassName</span>=<span class="string">&#x27;toolbarClassName&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">wrapperClassName</span>=<span class="string">&#x27;wrapperClassName&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">editorClassName</span>=<span class="string">&#x27;editorClassName&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onEditorStateChange</span>=<span class="string">&#123;editorState</span> =&gt;</span> setEditorState(editorState)&#125;</span></span><br><span class="line"><span class="xml">                onBlur=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="xml">                    props.getContent(draftToHtml(convertToRaw(editorState.getCurrentContent())));</span></span><br><span class="line"><span class="xml">                &#125;&#125; /&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>support Audit feature. bind a handleAudit event then fine for supporting this feature.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleAudit = <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">        axios.patch(<span class="string">`/api/news/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">auditState</span>: <span class="number">1</span></span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            navigate(<span class="string">&#x27;/audit-manage/list&#x27;</span>);</span><br><span class="line">            notification.info(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">`Notification`</span>,</span><br><span class="line">                <span class="attr">description</span>:</span><br><span class="line">                    <span class="string">`Please go to audit box for checking your news`</span>,</span><br><span class="line">                <span class="attr">placement</span>: <span class="string">&#x27;bottomRight&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/27/npm-with-login/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/27/npm-with-login/" class="post-title-link" itemprop="url">news-pubish-management(3)--login</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-27 08:39:53" itemprop="dateCreated datePublished" datetime="2021-12-27T08:39:53+00:00">2021-12-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>It’s time to implement a Login componnet.</p>
<h3 id="1-Login-out-in-TopHeader-js"><a href="#1-Login-out-in-TopHeader-js" class="headerlink" title="1. Login out in TopHeader.js"></a>1. Login out in <code>TopHeader.js</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useNavigate &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">danger</span> <span class="attr">key</span>=<span class="string">&#x27;loginOutMenu&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="xml">            localStorage.removeItem(&#x27;token&#x27;);</span></span><br><span class="line"><span class="xml">            navigate(&#x27;/login&#x27;);</span></span><br><span class="line"><span class="xml">&#125;&#125;&gt;Login out<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-create-Login-component-in-src-views-login-Login-js"><a href="#2-create-Login-component-in-src-views-login-Login-js" class="headerlink" title="2. create Login component in src/views/login/Login.js"></a>2. create Login component in <span style="color:lightblue">src/views/login/Login.js</span></h3><p>we use <a target="_blank" rel="noopener" href="https://github.com/matteobruni/tsparticles/tree/main/components/react">particles</a> for performing paticles.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-tsparticles</span><br><span class="line"></span><br><span class="line">touch src/views/login/Login.css</span><br></pre></td></tr></table></figure>
<p>The css looks like below:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.formContainer</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.7</span>);</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>,-<span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.loginTitle</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">color</span>:white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We use <code>localStorage</code> to store token for verifing and retrieving.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onFormFinish = <span class="function">(<span class="params">values</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(values);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Because the limition of Json-server, here we chose verb get. we should use post in real db.</span></span><br><span class="line">    axios.get(<span class="string">`/api/users?_expand=role&amp;username=<span class="subst">$&#123;values.username&#125;</span>&amp;password=<span class="subst">$&#123;values.password&#125;</span>&amp;roleState=true`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(res.data);</span></span><br><span class="line">        <span class="keyword">if</span>(res.data.length === <span class="number">0</span>) &#123;</span><br><span class="line">            message.error(<span class="string">`UserName or Password is wrong!`</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;token&#x27;</span>,<span class="built_in">JSON</span>.stringify(res.data[<span class="number">0</span>]));</span><br><span class="line">            navigate(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-Back-to-TopHeader-js-to-perform-and-add-real-information-in-there"><a href="#3-Back-to-TopHeader-js-to-perform-and-add-real-information-in-there" class="headerlink" title="3. Back to TopHeader.js to perform and add real information in there."></a>3. Back to <code>TopHeader.js</code> to perform and add real information in there.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">role</span>: &#123; roleName &#125;, username &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br></pre></td></tr></table></figure>
<h3 id="4-Checking-the-SideMenu-we-should-guarantee-difference-user-has-difference-menu"><a href="#4-Checking-the-SideMenu-we-should-guarantee-difference-user-has-difference-menu" class="headerlink" title="4. Checking the SideMenu, we should guarantee difference user has difference menu."></a>4. Checking the <code>SideMenu</code>, we should guarantee difference user has difference menu.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">role</span>: &#123; rights &#125; &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> checkPagePermission = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item.pagepermission === <span class="number">1</span> &amp;&amp; rights.includes(item.key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-locale-admin-only-see-his-region-user-and-himself-perform-in-UserList-js"><a href="#5-locale-admin-only-see-his-region-user-and-himself-perform-in-UserList-js" class="headerlink" title="5. locale admin only see his region user and himself, perform in UserList.js"></a>5. locale admin only see his region user and himself, perform in <code>UserList.js</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; roleId, region, username &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> roleObj = &#123;</span><br><span class="line">    <span class="string">&quot;1&quot;</span>: <span class="string">&quot;superadmin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;2&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;3&quot;</span>: <span class="string">&quot;editor&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    axios.get(<span class="string">`/api/users?_expand=role`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(res.data);</span></span><br><span class="line">        <span class="comment">// setDataSource(res.data);</span></span><br><span class="line">        <span class="keyword">const</span> list = res.data;</span><br><span class="line">        setDataSource(roleObj[roleId] === <span class="string">&#x27;superadmin&#x27;</span> ? list : [</span><br><span class="line">            ...list.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.username === username),</span><br><span class="line">            ...list.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.region === region &amp;&amp; roleObj[item.roleId] === <span class="string">&#x27;editor&#x27;</span>)</span><br><span class="line">        ]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<h3 id="6-Difference-use-has-difference-permission-in-add-and-edit-user-form"><a href="#6-Difference-use-has-difference-permission-in-add-and-edit-user-form" class="headerlink" title="6. Difference use has difference permission in add and edit user form."></a>6. Difference use has difference permission in add and edit user form.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; roleId, region &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line">    <span class="keyword">const</span> roleObj = &#123;</span><br><span class="line">        <span class="string">&quot;1&quot;</span>: <span class="string">&quot;superadmin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;2&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;3&quot;</span>: <span class="string">&quot;editor&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> checkRegionDisabled = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (roleObj[roleId] === <span class="string">&#x27;superadmin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (props.isUpdate) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> item.value !== region;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> checkRoleDisabled = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (roleObj[roleId] === <span class="string">&#x27;superadmin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (props.isUpdate) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> roleObj[item.id] !== <span class="string">&#x27;editor&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-Guarantee-deep-link-for-crashing-permission-in-difference-user"><a href="#7-Guarantee-deep-link-for-crashing-permission-in-difference-user" class="headerlink" title="7. Guarantee deep link for crashing permission in difference user."></a>7. Guarantee deep link for crashing permission in difference user.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch src/components/sandbox/NewsRouter.js</span><br></pre></td></tr></table></figure>
<p>This is a second level router, the content we can copy from NewsSandBox.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Routes, Route, Navigate &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/home/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NoPermission <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/nopermission/NoPermission&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RightList <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/right-manage/RightList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RoleList <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/right-manage/RoleList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> UserList <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/user-manage/UserList&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;home&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;user-manage/list&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">UserList</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;right-manage/role/list&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">RoleList</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;right-manage/right/list&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">RightList</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Navigate</span> <span class="attr">replace</span> <span class="attr">from</span>=<span class="string">&quot;/&quot;</span> <span class="attr">to</span>=<span class="string">&quot;home&quot;</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">NoPermission</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-Create-route-dynamiclly"><a href="#8-Create-route-dynamiclly" class="headerlink" title="8 Create route dynamiclly"></a>8 Create route dynamiclly</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir src/views/sandbox/news-manage</span><br><span class="line">touch src/views/sandbox/news-manage/NewsAdd.js</span><br><span class="line">touch src/views/sandbox/news-manage/NewsDraft.js</span><br><span class="line">touch src/views/sandbox/news-manage/NewsCategory.js</span><br><span class="line">mkdir src/views/sandbox/audit-manage</span><br><span class="line">touch src/views/sandbox/audit-manage/Audit.js</span><br><span class="line">touch src/views/sandbox/audit-manage/AuditList.js</span><br><span class="line">mkdir src/views/sandbox/publish-manage</span><br><span class="line">touch src/views/sandbox/publish-manage/Unpublished.js</span><br><span class="line">touch src/views/sandbox/publish-manage/Published.js</span><br><span class="line">touch src/views/sandbox/publish-manage/Sunset.js</span><br></pre></td></tr></table></figure>
<p>defined a localRouteMap and use map for crating route.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Routes, Route, Navigate &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Audit <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/audit-manage/Audit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> AuditList <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/audit-manage/AuditList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/home/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NewsAdd <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/news-manage/NewsAdd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NewsCategory <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/news-manage/NewsCategory&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NewsDraft <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/news-manage/NewsDraft&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NoPermission <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/nopermission/NoPermission&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Published <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/publish-manage/Published&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Sunset <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/publish-manage/Sunset&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Unpublished <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/publish-manage/Unpublished&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RightList <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/right-manage/RightList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RoleList <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/right-manage/RoleList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> UserList <span class="keyword">from</span> <span class="string">&#x27;../../views/sandbox/user-manage/UserList&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LocalRouterMap = &#123;</span><br><span class="line">    <span class="string">&quot;/home&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/user-manage/list&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">UserList</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/right-manage/role/list&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">RoleList</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/right-manage/right/list&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">RightList</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/news-manage/add&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">NewsAdd</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/news-manage/draft&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">NewsDraft</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/news-manage/category&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">NewsCategory</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/audit-manage/audit&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">Audit</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/audit-manage/list&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">AuditList</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/publish-manage/unpublished&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">Unpublished</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/publish-manage/published&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">Published</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&quot;/publish-manage/sunset&quot;</span>: <span class="xml"><span class="tag">&lt;<span class="name">Sunset</span> /&gt;</span></span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [BackRouteList, setBackRouteList] = useState([]);</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">Promise</span>.all([</span><br><span class="line">            axios.get(<span class="string">`/api/rights`</span>),</span><br><span class="line">            axios.get(<span class="string">`/api/children`</span>),</span><br><span class="line">        ]).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setBackRouteList([...res[<span class="number">0</span>].data, ...res[<span class="number">1</span>].data]);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;BackRouteList.map(item =&gt; (</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">path</span>=<span class="string">&#123;item.key&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">key</span>=<span class="string">&#123;item.key&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">element</span>=<span class="string">&#123;LocalRouterMap[item.key]&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                /&gt;</span></span></span><br><span class="line"><span class="xml">            ))&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Navigate</span> <span class="attr">replace</span> <span class="attr">from</span>=<span class="string">&quot;/&quot;</span> <span class="attr">to</span>=<span class="string">&quot;home&quot;</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">NoPermission</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>add permission for route checking and user checking</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const checkRoute = item =&gt; &#123;</span><br><span class="line">    return LocalRouterMap[item.key] &amp;&amp; item.pagepermission;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const checkUserPermission = item =&gt; &#123;</span><br><span class="line">    return rights.includes(item.key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const &#123; role: &#123; rights &#125; &#125; = JSON.parse(localStorage.getItem(&#x27;token&#x27;));</span><br></pre></td></tr></table></figure>

<h3 id="9-Add-progress-in-NewsSandBox"><a href="#9-Add-progress-in-NewsSandBox" class="headerlink" title="9. Add progress in NewsSandBox"></a>9. Add progress in <code>NewsSandBox</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add nprogress</span><br></pre></td></tr></table></figure>
<p>we use <a target="_blank" rel="noopener" href="https://github.com/rstacruz/nprogress">NProcess</a> to peform this progress feature.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nProgress <span class="keyword">from</span> <span class="string">&#x27;nprogress&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;nprogress/nprogress.css&#x27;</span></span><br><span class="line">    </span><br><span class="line">    nProgress.start()</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        nProgress.done();</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/26/npm-with-right-role-user/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/26/npm-with-right-role-user/" class="post-title-link" itemprop="url">news-pubish-management(2)--right, role and user</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-26 11:31:31" itemprop="dateCreated datePublished" datetime="2021-12-26T11:31:31+00:00">2021-12-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Today let perform the right and role in news-publish-management</p>
<h3 id="1-Use-the-Table-Basic-component-in-src-views-sandbox-right-manage-RightList-js"><a href="#1-Use-the-Table-Basic-component-in-src-views-sandbox-right-manage-RightList-js" class="headerlink" title="1. Use the Table Basic component in src/views/sandbox/right-manage/RightList.js"></a>1. Use the <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/table/#components-table-demo-basic">Table Basic</a> component in <span style="color:lightblue">src/views/sandbox/right-manage/RightList.js</span></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Table &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">RightList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;权限名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;权限名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;key&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/api/rights&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setDataSource(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Custom-some-column-we-can-use-render-property-render-proeprty-must-a-function-function-first-in-Ant"><a href="#2-Custom-some-column-we-can-use-render-property-render-proeprty-must-a-function-function-first-in-Ant" class="headerlink" title="2.Custom some column, we can use render property, render proeprty must a function. function first in Ant"></a>2.Custom some column, we can use render property, render proeprty must a function. function first in Ant</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">id</span>)=&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;id&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;权限名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;权限路径&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;key&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">key</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Tag</span> <span class="attr">color</span>=<span class="string">&#x27;orange&#x27;</span>&gt;</span>&#123;key&#125;<span class="tag">&lt;/<span class="name">Tag</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure>
<h3 id="3-Add-operation-column-in-the-table-component"><a href="#3-Add-operation-column-in-the-table-component" class="headerlink" title="3. Add operation column in the table component"></a>3. Add operation column in the table component</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    DeleteOutlined,</span><br><span class="line">    EditOutlined,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line">...</span><br><span class="line">    &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-Add-pagenition-for-Table"><a href="#4-Add-pagenition-for-Table" class="headerlink" title="4. Add pagenition for Table"></a>4. Add pagenition for Table</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Table dataSource=&#123;dataSource&#125; columns=&#123;columns&#125; pagination=&#123;&#123; <span class="attr">pageSize</span>: <span class="number">5</span> &#125;&#125; /&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="5-use-Tree-to-display-children-it-is-pretty-easy-change-the-useEffect-to"><a href="#5-use-Tree-to-display-children-it-is-pretty-easy-change-the-useEffect-to" class="headerlink" title="5. use Tree to display children, it is pretty easy, change the useEffect to"></a>5. use Tree to display children, it is pretty easy, change the <code>useEffect</code> to</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    axios.get(<span class="string">&quot;/api/rights?_embed=children&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(res.data);</span></span><br><span class="line">        res.data.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> item.children?.length === <span class="number">0</span> ? item.children = <span class="string">&quot;&quot;</span> : item.children);</span><br><span class="line">        setDataSource(res.data);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Here the <code>Tree</code> is not the <code>Tree</code> antd component, it is one of the column in <code>RightList</code>. </p>
</blockquote>
<h3 id="6-Get-and-Edit-in-RightList-js"><a href="#6-Get-and-Edit-in-RightList-js" class="headerlink" title="6. Get and Edit in RightList.js"></a>6. Get and Edit in <code>RightList.js</code></h3><p>Because delete is danger,so we popup a <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/modal/#components-modal-demo-basic">Model Basic</a> information for confirming.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//show confirm modal</span></span><br><span class="line"><span class="keyword">const</span> confirmDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    confirm(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Do you Want to delete these items?&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">        <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(&#x27;OK&#x27;);</span></span><br><span class="line">            realDelete(item)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;Cancel&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//delete item in both frontEnd and backEnd</span></span><br><span class="line"><span class="keyword">const</span> realDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(item);</span></span><br><span class="line">    setDataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id));</span><br><span class="line">    axios.delete(<span class="string">`/api/rights/<span class="subst">$&#123;item.id&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>above command can delete level 1 menu, but when we try to delete level 2 menu, then we wil encountered an issue says the data not found. How to delete level 2 menu? Let’s look back the response data. We can get the first level data according the rightId, and then filter the children, and then send delete in children table.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> realDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(item);</span></span><br><span class="line">    <span class="keyword">if</span> (item.grade === <span class="number">1</span>) &#123;</span><br><span class="line">        setDataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id));</span><br><span class="line">        axios.delete(<span class="string">`/api/rights/<span class="subst">$&#123;item.id&#125;</span>`</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> list = dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id === item.rightId);</span><br><span class="line">        list[<span class="number">0</span>].children = list[<span class="number">0</span>].children.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id);</span><br><span class="line">        setDataSource([...dataSource]);</span><br><span class="line">        axios.delete(<span class="string">`/api/children/<span class="subst">$&#123;item.id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Another button is Edit button, edit button control the page configuration. We will chose Popover to perform this feature.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;Popover</span><br><span class="line">    content=&#123;<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">textAlign:</span> &#x27;<span class="attr">center</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Switch</span> <span class="attr">checked</span>=<span class="string">&#123;item.pagepermission&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;()</span> =&gt;</span> swithPageConfiguration(item)&#125;&gt;<span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;</span><br><span class="line">    title=<span class="string">&quot;Page configuration&quot;</span> trigger=&#123;item.pagepermission === <span class="literal">undefined</span> ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27;click&#x27;</span>&#125;&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; disabled=&#123;item.pagepermission === undefined&#125; /&gt;</span></span><br><span class="line">&lt;/Popover&gt;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> swithPageConfiguration = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(item);</span></span><br><span class="line">    item.pagepermission = item.pagepermission === <span class="number">1</span> ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    setDataSource([...dataSource])</span><br><span class="line">    <span class="keyword">if</span> (item.grade === <span class="number">1</span>) &#123;</span><br><span class="line">        axios.patch(<span class="string">`/api/rights/<span class="subst">$&#123;item.id&#125;</span>`</span>, &#123; <span class="attr">pagepermission</span>: item.pagepermission &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        axios.patch(<span class="string">`/api/children/<span class="subst">$&#123;item.id&#125;</span>`</span>, &#123; <span class="attr">pagepermission</span>: item.pagepermission &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-Use-Table-to-perform-role-in-RoleList-js"><a href="#7-Use-Table-to-perform-role-in-RoleList-js" class="headerlink" title="7. Use Table to perform role in RoleList.js"></a>7. Use Table to perform role in <code>RoleList.js</code></h3><p>We already implemented the RightList, so we can refer that implement.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table, Modal &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    DeleteOutlined,</span><br><span class="line">    EditOutlined,</span><br><span class="line">    ExclamationCircleOutlined,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; confirm &#125; = Modal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">RoleList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">id</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;id&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;roleName&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; onClick=&#123;() =&gt; confirmDelete(item)&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmDelete = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Do you Want to delete these items?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">// console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                realDelete(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;Cancel&#x27;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> realDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item);</span></span><br><span class="line">        setDataSource(dataSource.filter(<span class="function"><span class="params">data</span> =&gt;</span> data.id !== item.id));</span><br><span class="line">        axios.delete(<span class="string">`/api/roles/<span class="subst">$&#123;item.id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/api/roles&quot;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setDataSource(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; /&gt;;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>use <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/tree/#components-tree-demo-basic">Tree Basic</a> component to perform edit feature in <code>RoleList.js</code></p>
<p>Also we use <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/modal/#components-modal-demo-basic">Modal Basic</a> to popup the tree.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;Modal title=<span class="string">&quot;Permisson Configuration&quot;</span> visible=&#123;isModalVisible&#125; onOk=&#123;handleOk&#125; onCancel=&#123;handleCancel&#125;&gt;</span><br><span class="line">                <span class="xml"><span class="tag">&lt;<span class="name">Tree</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">checkable</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">checkedKeys</span>=<span class="string">&#123;currentRights&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">onCheck</span>=<span class="string">&#123;handleCheck&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">checkStrictly</span>=<span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">treeData</span>=<span class="string">&#123;treeData&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                /&gt;</span></span></span><br><span class="line">&lt;/Modal&gt;</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">const</span> [treeData, setTreeData] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [currentRights, setCurrentRights] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [currentId, setCurrentId] = useState(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> [isModalVisible, setIsModalVisible] = useState(<span class="literal">false</span>);</span><br><span class="line">...    </span><br><span class="line">    <span class="keyword">const</span> editPermission = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        setIsModalVisible(<span class="literal">true</span>);</span><br><span class="line">        setCurrentRights(item.rights);</span><br><span class="line">        setCurrentId(item.id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleOk = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setIsModalVisible(<span class="literal">false</span>);</span><br><span class="line">        setDataSource(dataSource.map(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(item.id == currentId) &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    ...item,</span><br><span class="line">                    <span class="attr">rights</span>: currentRights</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        axios.patch(<span class="string">`/api/roles/<span class="subst">$&#123;currentId&#125;</span>`</span>,&#123;<span class="attr">rights</span>:currentRights&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> handleCancel = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setIsModalVisible(<span class="literal">false</span>);</span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleCheck = <span class="function">(<span class="params">checkedKeys</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(checkedKeys);</span></span><br><span class="line">        setCurrentRights(checkedKeys);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/rights?_embed=children`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setTreeData(res.data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);  </span><br></pre></td></tr></table></figure>
<h3 id="8-Use-Table-to-perform-user-in-UserList-js"><a href="#8-Use-Table-to-perform-user-in-UserList-js" class="headerlink" title="8. Use Table to perform user in UserList.js"></a>8. Use Table to perform user in <code>UserList.js</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table, Modal, Switch &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    DeleteOutlined,</span><br><span class="line">    EditOutlined,</span><br><span class="line">    ExclamationCircleOutlined,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; confirm &#125; = Modal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;区域&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">region</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;region === &#x27;&#x27; ? &#x27;Global&#x27; : region&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;role&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">role</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> role?.roleName</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;username&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;用户状态&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;roleState&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">roleState, item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Switch</span> <span class="attr">checked</span>=<span class="string">&#123;roleState&#125;</span> <span class="attr">disabled</span>=<span class="string">&#123;item.default&#125;</span> &gt;</span><span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; disabled=&#123;item.default&#125; onClick=&#123;() =&gt; confirmDelete(item)&#125; /&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; disabled=&#123;item.default&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmDelete = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Do you Want to delete these items?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">// console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                realDelete(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;Cancel&#x27;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> realDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/users?_expand=role`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            res.data.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> item.children?.length === <span class="number">0</span> ? item.children = <span class="string">&quot;&quot;</span> : item.children);</span><br><span class="line">            setDataSource(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; /&gt;;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-CRUD-user-in-UserList-js"><a href="#9-CRUD-user-in-UserList-js" class="headerlink" title="9. CRUD user in UserList.js"></a>9. CRUD user in <code>UserList.js</code></h3><p>use <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/form/#components-form-demo-form-in-modal">Form in Modal</a> component to perform this feature.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table, Modal, Switch, Form, Input, Select &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    DeleteOutlined,</span><br><span class="line">    EditOutlined,</span><br><span class="line">    ExclamationCircleOutlined,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; confirm &#125; = Modal;</span><br><span class="line"><span class="keyword">const</span> &#123; Option &#125; = Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dataSource, setDataSource] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [regionList, setRegionList] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [roleList, setRoleList] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [addFormVisible, setAddFormVisible] = useState(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> columns = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;区域&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">region</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;region === &#x27;&#x27; ? &#x27;Global&#x27; : region&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;role&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">role</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> role?.roleName</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;username&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;用户状态&#x27;</span>,</span><br><span class="line">            <span class="attr">dataIndex</span>: <span class="string">&#x27;roleState&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function">(<span class="params">roleState, item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Switch</span> <span class="attr">checked</span>=<span class="string">&#123;roleState&#125;</span> <span class="attr">disabled</span>=<span class="string">&#123;item.default&#125;</span> &gt;</span><span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">            <span class="attr">render</span>: <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">danger</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">DeleteOutlined</span> /&gt;</span>&#125; disabled=&#123;item.default&#125; onClick=&#123;() =&gt; confirmDelete(item)&#125; /&gt;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">shape</span>=<span class="string">&#x27;circle&#x27;</span> <span class="attr">icon</span>=<span class="string">&#123;</span>&lt;<span class="attr">EditOutlined</span> /&gt;</span>&#125; disabled=&#123;item.default&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmDelete = <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Do you Want to delete these items?&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">            <span class="function"><span class="title">onOk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="comment">// console.log(&#x27;OK&#x27;);</span></span><br><span class="line">                realDelete(item)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="title">onCancel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;Cancel&#x27;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> realDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(item);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/users?_expand=role`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setDataSource(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/regions`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setRegionList(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/roles`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setRoleList(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setAddFormVisible(true)&#125;&gt;Add new user<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Table</span> <span class="attr">dataSource</span>=<span class="string">&#123;dataSource&#125;</span> <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span> <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span> <span class="attr">pageSize:</span> <span class="attr">5</span> &#125;&#125; <span class="attr">rowKey</span>=<span class="string">&#123;item</span> =&gt;</span> item.id&#125; /&gt;;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Modal</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">visible</span>=<span class="string">&#123;addFormVisible&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">title</span>=<span class="string">&quot;Create a new user&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">okText</span>=<span class="string">&quot;Create&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">cancelText</span>=<span class="string">&quot;Cancel&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onCancel</span>=<span class="string">&#123;()</span> =&gt;</span> setAddFormVisible(false)&#125;</span></span><br><span class="line"><span class="xml">                onOk=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="xml">                    setAddFormVisible(false);</span></span><br><span class="line"><span class="xml">                &#125;&#125;&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Form</span> <span class="attr">layout</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">name</span>=<span class="string">&quot;username&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">label</span>=<span class="string">&quot;User Name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">user</span> <span class="attr">name</span>!&#x27; &#125;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">label</span>=<span class="string">&quot;Password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">password</span>!&#x27; &#125;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Input</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">name</span>=<span class="string">&quot;region&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">label</span>=<span class="string">&quot;Region&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">region</span>!&#x27; &#125;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#123;</span></span><br><span class="line"><span class="xml">                                regionList.map(item =&gt;</span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.value&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                )</span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Form.Item</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">name</span>=<span class="string">&quot;roleId&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">label</span>=<span class="string">&quot;Role&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">rules</span>=<span class="string">&#123;[&#123;</span> <span class="attr">required:</span> <span class="attr">true</span>, <span class="attr">message:</span> &#x27;<span class="attr">Please</span> <span class="attr">input</span> <span class="attr">the</span> <span class="attr">role</span>!&#x27; &#125;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#123;</span></span><br><span class="line"><span class="xml">                                roleList.map(item =&gt;</span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.roleName&#125;<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                )</span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Form.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-Wrapper-addForm-as-component"><a href="#10-Wrapper-addForm-as-component" class="headerlink" title="10. Wrapper addForm as component"></a>10. Wrapper addForm as component</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir src/components/user-manage</span><br><span class="line">touch src/components/user-manage/UserForm.js</span><br></pre></td></tr></table></figure>
<p>Copy the Form section to this file.</p>
<blockquote>
<p>use <code>forwardRef</code> for exporting <code>UserForm.js</code> for communicating with <code>UserList.js</code></p>
</blockquote>
<p>create a <code>ref</code> in <code>UserList.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> addForm = useRef(<span class="literal">null</span>);</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;Modal</span><br><span class="line">    visible=&#123;addFormVisible&#125;</span><br><span class="line">    title=<span class="string">&quot;Create a new user&quot;</span></span><br><span class="line">    okText=<span class="string">&quot;Create&quot;</span></span><br><span class="line">    cancelText=<span class="string">&quot;Cancel&quot;</span></span><br><span class="line">    onCancel=&#123;<span class="function">() =&gt;</span> setAddFormVisible(<span class="literal">false</span>)&#125;</span><br><span class="line">    onOk=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(addForm);</span></span><br><span class="line">        addForm.current.validateFields().then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(value)</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;&#125;&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">UserForm</span> <span class="attr">regionList</span>=<span class="string">&#123;regionList&#125;</span> <span class="attr">roleList</span>=<span class="string">&#123;roleList&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;addForm&#125;</span> /&gt;</span></span></span><br><span class="line">&lt;/Modal&gt;    </span><br></pre></td></tr></table></figure>
<p>The <code>UserForm.js</code> we change the definition formation</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UserForm = forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">layout</span>=<span class="string">&quot;vertical&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> &gt;</span></span></span><br><span class="line"><span class="xml">        ...</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> UserForm;        </span><br></pre></td></tr></table></figure>
<p>we can set the modalOk as below</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> addFormOk = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(addForm);</span></span><br><span class="line">        addForm.current.validateFields().then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(value)</span></span><br><span class="line">            setAddFormVisible(<span class="literal">false</span>);</span><br><span class="line">            addForm.current.resetFields();</span><br><span class="line">            axios.post(<span class="string">`/api/users`</span>,&#123;</span><br><span class="line">                ...value,</span><br><span class="line">                <span class="string">&#x27;roleState&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&#x27;default&#x27;</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="comment">// console.log(res.data);</span></span><br><span class="line">                setDataSource([...dataSource, &#123;...res.data,</span><br><span class="line">                <span class="attr">role</span>: roleList.filter(<span class="function"><span class="params">item</span>=&gt;</span>item.id=value.roleId)[<span class="number">0</span>]&#125;])</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Delete user in <code>UserList.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> realDelete = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="comment">// console.log(item);</span></span><br><span class="line">     setDataSource(dataSource.filter(<span class="function"><span class="params">data</span>=&gt;</span>data.id!==item.id));</span><br><span class="line">     axios.delete(<span class="string">`/api/users/<span class="subst">$&#123;item.id&#125;</span>`</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>Update user status in <code>UserList.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;用户状态&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;roleState&#x27;</span>,</span><br><span class="line">        <span class="attr">render</span>: <span class="function">(<span class="params">roleState, item</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Switch</span> <span class="attr">checked</span>=<span class="string">&#123;roleState&#125;</span> <span class="attr">disabled</span>=<span class="string">&#123;item.default&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;()</span> =&gt;</span> handleUserState(item)&#125; &gt;<span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ....</span><br><span class="line"><span class="keyword">const</span> handleUserState = <span class="function">(<span class="params">item</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(item);</span></span><br><span class="line">    item.roleState = !item.roleState;</span><br><span class="line">    setDataSource([...dataSource])</span><br><span class="line">    axios.patch(<span class="string">`/api/users/<span class="subst">$&#123;item.id&#125;</span>`</span>,&#123;<span class="attr">roleState</span>:item.roleState&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Update user in <code>UserList.js</code><br>It is very similar with addForm, so copy an updateForm modal.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">omit</span><br></pre></td></tr></table></figure>
<p>Filter data in <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/table-cn/#components-table-demo-head">region field</a> in UserList.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> columns = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;区域&#x27;</span>,</span><br><span class="line">        <span class="attr">dataIndex</span>: <span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">        <span class="attr">filters</span>: [</span><br><span class="line">            ...regionList.map(<span class="function"><span class="params">item</span> =&gt;</span> (&#123;</span><br><span class="line">                <span class="attr">text</span>: item.title,</span><br><span class="line">                <span class="attr">value</span>: item.value</span><br><span class="line">            &#125;)),</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;Global&#x27;</span>,</span><br><span class="line">                <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">onFilter</span>: <span class="function">(<span class="params">value, item</span>) =&gt;</span> item.region === value,</span><br><span class="line">        <span class="attr">render</span>: <span class="function">(<span class="params">region</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;region === &#x27;&#x27; ? &#x27;Global&#x27; : region&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/25/npm-with-layout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/25/npm-with-layout/" class="post-title-link" itemprop="url">news-pubish-management(1)--layout</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-25 14:44:01" itemprop="dateCreated datePublished" datetime="2021-12-25T14:44:01+00:00">2021-12-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Here I am going to perform the layout first for news-publish-management</p>
<h3 id="1-Setup-setupProxy-js"><a href="#1-Setup-setupProxy-js" class="headerlink" title="1. Setup setupProxy.js"></a>1. Setup setupProxy.js</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add http-proxy-middleware</span><br><span class="line">touch src/setupProxy.js</span><br></pre></td></tr></table></figure>
<p>copy below <a target="_blank" rel="noopener" href="https://create-react-app.dev/docs/proxying-api-requests-in-development/#configuring-the-proxy-manually">code-snippets</a> into <span style="color:lightblue">setupProxy</span>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app</span>) </span>&#123;</span><br><span class="line">  app.use(</span><br><span class="line">    <span class="string">&#x27;/api&#x27;</span>,</span><br><span class="line">    createProxyMiddleware(&#123;</span><br><span class="line">      <span class="attr">target</span>: <span class="string">&#x27;https://news-publish-management.herokuapp.com&#x27;</span>,</span><br><span class="line">      <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="string">``</span><span class="string">``</span></span><br><span class="line">&gt; Why we setup like <span class="built_in">this</span> <span class="keyword">in</span> our project? The main reason <span class="keyword">for</span> doing <span class="built_in">this</span> is avoids [CORS](https:<span class="comment">//stackoverflow.com/questions/21854516/understanding-ajax-cors-and-security-considerations) issues </span></span><br><span class="line">### <span class="number">2.</span> Setup router</span><br><span class="line"><span class="string">``</span><span class="string">`bash</span></span><br><span class="line"><span class="string">yarn add react-router-dom</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mkdir src/router                  </span></span><br><span class="line"><span class="string">touch src/router/IndexRouter.js</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mkdir src/views</span></span><br><span class="line"><span class="string">mkdir src/views/login</span></span><br><span class="line"><span class="string">touch src/views/login/Login.js</span></span><br><span class="line"><span class="string">mkdir src/views/sandbox</span></span><br><span class="line"><span class="string">touch src/views/sandbox/NewsSandBox.js</span></span><br><span class="line"><span class="string">mkdir src/views/sandbox/home</span></span><br><span class="line"><span class="string">touch src/views/sandbox/home/Home.js</span></span><br><span class="line"><span class="string">mkdir src/views/sandbox/user-manage</span></span><br><span class="line"><span class="string">touch src/views/sandbox/user-manage/UserList.js</span></span><br><span class="line"><span class="string">mkdir src/views/sandbox/right-manage</span></span><br><span class="line"><span class="string">touch src/views/sandbox/right-manage/RightList.js</span></span><br><span class="line"><span class="string">touch src/views/sandbox/right-manage/RoleList.js</span></span><br><span class="line"><span class="string">mkdir src/views/sandbox/nopermission</span></span><br><span class="line"><span class="string">touch src/views/sandbox/nopermission/NoPermission.js</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mkdir src/components </span></span><br><span class="line"><span class="string">mkdir src/components/sandbox</span></span><br><span class="line"><span class="string">touch src/components/sandbox/SideMenu.js</span></span><br><span class="line"><span class="string">touch src/components/sandbox/TopHeader.js</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>Every each JS file we can add below code-snippets for creating react function component quickly.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">ComponentName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ComponentName</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>We can install a plugin <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=dsznajder.es7-react-js-snippets">ES7 React/Redux/GraphQL/React-Native snippets</a> for <a target="_blank" rel="noopener" href="https://code.visualstudio.com/">VS Code</a>. Once install successfully, use key <code>rfc</code> for lightning generating above code-snippets.</p>
</blockquote>
<p>We assume <span style="color:lightblue">src/router/IndexRouter.js</span> is the first level router, when user already logined the system,  they will be redirected to <span style="color:lightblue">src/views/sandbox/NewsSandBox.js</span>, otherwise they will be redireted to <span style="color:lightblue">src/views/login/Login.js</span>. So the <span style="color:lightblue">IndexRouter.js</span> looks like below</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter, Routes, Route, Navigate &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&#x27;../views/login/Login&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NewsSandBox <span class="keyword">from</span> <span class="string">&#x27;../views/sandbox/NewsSandBox&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">IndexRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Login</span>/&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;localStorage.getItem(</span>&quot;<span class="attr">token</span>&quot;) ? &lt;<span class="attr">NewsSandBox</span>/&gt;</span> : <span class="tag">&lt;<span class="name">Navigate</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Go to <span style="color:lightblue">src/App.js</span>, and import our <span style="color:lightblue">src/router/IndexRouter.js</span> component.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> IndexRouter <span class="keyword">from</span> <span class="string">&#x27;./router/IndexRouter&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">IndexRouter</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Go to browser, url <code>https//localhost:3000</code> will show our <code>Login</code> component. If you manually setup the token with command of </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">localStorage</span>.setItem(<span class="string">&quot;token&quot;</span>,<span class="string">&quot;token&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>then the browser will show <code>NewsSandBox</code> component.</p>
<h3 id="3-Assume-NewsSandBox-js-as-a-second-level-router-and-change-its-content-to"><a href="#3-Assume-NewsSandBox-js-as-a-second-level-router-and-change-its-content-to" class="headerlink" title="3. Assume NewsSandBox.js  as a second level router, and change its content to"></a>3. Assume <span style="color:lightblue">NewsSandBox.js </spn> as a second level router, and change its content to</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Routes, Route, Navigate &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> SideMenu <span class="keyword">from</span> <span class="string">&#x27;../../components/sandbox/SideMenu&#x27;</span></span><br><span class="line"><span class="keyword">import</span> TopHeader <span class="keyword">from</span> <span class="string">&#x27;../../components/sandbox/TopHeader&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;./home/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NoPermission <span class="keyword">from</span> <span class="string">&#x27;./nopermission/NoPermission&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RightList <span class="keyword">from</span> <span class="string">&#x27;./right-manage/RightList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RoleList <span class="keyword">from</span> <span class="string">&#x27;./right-manage/RoleList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> UserList <span class="keyword">from</span> <span class="string">&#x27;./user-manage/UserList&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">NewsSandBox</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">SideMenu</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">TopHeader</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;home&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;user-manage/list&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">UserList</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;right-manage/role/list&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">RoleList</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;right-manage/right/list&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">RightList</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Navigate</span> <span class="attr">replace</span> <span class="attr">from</span>=<span class="string">&quot;/&quot;</span> <span class="attr">to</span>=<span class="string">&quot;home&quot;</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">NoPermission</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-Import-Ant-Design-and-setup-layout-our-layout-was-designed-in-src-views-sandbox-NewsSandBox-js-NewsSandBox-contains-src-components-sandbox-TopHeader-js-and-src-componets-sandbox-SideMenu-js"><a href="#4-Import-Ant-Design-and-setup-layout-our-layout-was-designed-in-src-views-sandbox-NewsSandBox-js-NewsSandBox-contains-src-components-sandbox-TopHeader-js-and-src-componets-sandbox-SideMenu-js" class="headerlink" title="4. Import Ant Design and setup layout, our layout was designed in src/views/sandbox/NewsSandBox.js. NewsSandBox contains src/components/sandbox/TopHeader.js and src/componets/sandbox/SideMenu.js`"></a>4. Import <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/">Ant Design</a> and setup layout, our layout was designed in <span style="color:lightblue">src/views/sandbox/NewsSandBox.js</span>. <code>NewsSandBox</code> contains <span style="color:lightblue">src/components/sandbox/TopHeader.js</span> and <span style="color:lightblue">src/componets/sandbox/SideMenu.js`</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add antd</span><br></pre></td></tr></table></figure>
<p>choose the <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/layout/#components-layout-demo-custom-trigger">custom trigger</a> as our layout. First thing is <code>show code</code> and copy code into <code>NewsSandBox</code> and then sperate them as below <br/></p>
<ul>
<li><code>Layout.Sider</code> was pasted to <code>SideMenu</code></li>
<li><code>Layout.Header</code> was pasted to <code>TopHeader</code></li>
</ul>
<blockquote>
<p>The import thing is don’t forget to copy the CSS into our <span style="color:lightblue">src/views/sandbox/NewsSandBox.css</span> file.</p>
</blockquote>
<h3 id="5-Add-click-event-on-the-collapsed-expanded-icon-in-src-components-sandbox-TopHeader-js"><a href="#5-Add-click-event-on-the-collapsed-expanded-icon-in-src-components-sandbox-TopHeader-js" class="headerlink" title="5. Add click event on the collapsed/expanded icon in src/components/sandbox/TopHeader.js."></a>5. Add click event on the collapsed/expanded icon in <span style="color:lightblue">src/components/sandbox/TopHeader.js</span>.</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [collapsed, setCollapsed] = useState(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changeCollapsed = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setCollapsed(!collapsed)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://reactjs.org/docs/hooks-state.html">React hooks</a>  is important. Here we use the <code>useState</code>.</p>
</blockquote>
<p>Then give the icon an onClick event property. for example</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MenuFoldOutlined onClick=&#123;changeCollapsed&#125; /&gt;</span><br></pre></td></tr></table></figure>

<h3 id="6-Add-Wellcome-user-in-the-TopHeader"><a href="#6-Add-Wellcome-user-in-the-TopHeader" class="headerlink" title="6. Add Wellcome user in the TopHeader."></a>6. Add <code>Wellcome user</code> in the TopHeader.</h3><p>We copy the <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/dropdown/#components-dropdown-demo-basic">Dropdown Basic</a> and <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/avatar/#components-avatar-demo-basic">Avator Basic</a> components and modify them as we expected.</p>
<h3 id="7-Modify-the-SideMenu"><a href="#7-Modify-the-SideMenu" class="headerlink" title="7. Modify the SideMenu"></a>7. Modify the SideMenu</h3><p>use <a target="_blank" rel="noopener" href="https://axios-http.com/docs/intro">axios</a> for getting data.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add axios</span><br><span class="line">mkdir src/util</span><br><span class="line">touch src/util/http.js</span><br></pre></td></tr></table></figure>
<p>http.js with content</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line">axios.defaults.baseURL=<span class="string">&quot;https://news-publish-management.herokuapp.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// axios.defaults.headers</span></span><br><span class="line"><span class="comment">// axios.interceptors.request.use</span></span><br><span class="line"><span class="comment">// axios.interceptors.response.use</span></span><br></pre></td></tr></table></figure>
<p>In this page, will use hook <code>useEffect</code> for getting data back and use  hook <code>useState</code> to control returned data</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Layout, Menu &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    UserOutlined,</span><br><span class="line">    HomeOutlined,</span><br><span class="line">    CrownOutlined,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useNavigate &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Sider &#125; = Layout;</span><br><span class="line"><span class="keyword">const</span> &#123; SubMenu &#125; = Menu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">SideMenu</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> navigate = useNavigate();</span><br><span class="line">    <span class="keyword">const</span> [menuList, setMenuList] = useState([]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> renderMenu = <span class="function">(<span class="params">menuList</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> menuList.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.children) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SubMenu</span> <span class="attr">key</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;item.icon&#125;</span> <span class="attr">title</span>=<span class="string">&#123;item.title&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;renderMenu(item.children)&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">SubMenu</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&#123;item.key&#125;</span> <span class="attr">icon</span>=<span class="string">&#123;item.icon&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> navigate(item.key)&#125;&gt;</span></span><br><span class="line"><span class="xml">                &#123;item.title&#125;<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&quot;/api/rights?_embed=children&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// console.log(res.data)</span></span><br><span class="line">            setMenuList(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Sider</span> <span class="attr">trigger</span>=<span class="string">&#123;null&#125;</span> <span class="attr">collapsible</span> <span class="attr">collapsed</span>=<span class="string">&#123;false&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;logo&quot;</span>&gt;</span>News Publish Management<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Menu</span> <span class="attr">theme</span>=<span class="string">&quot;dark&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;inline&quot;</span> <span class="attr">defaultSelectedKeys</span>=<span class="string">&#123;[</span>&#x27;<span class="attr">1</span>&#x27;]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;renderMenu(menuList)&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Menu</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Sider</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-Fix-some-issue-for-SideMenu"><a href="#8-Fix-some-issue-for-SideMenu" class="headerlink" title="8. Fix some issue for SideMenu"></a>8. Fix some issue for SideMenu</h3><p>Finished above 7 steps, the page should be correctly rendering, but it is weird, some menu should be in second level route, but it is in SideMenu, another thing is each of the menu without icon. Let’s fix those issues we identified so far:</p>
<ul>
<li>For issue 1, we can identifiy the field pagepermission, check its 1 or not.<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> checkPagePermission = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item.pagepermission === <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>pagepermission is very important!!</p>
</blockquote>
</li>
<li>For issue 2, we can define an iconList to store icon, and use array[index] to get the icon.<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> iconList = &#123;</span><br><span class="line">    <span class="string">&#x27;/home&#x27;</span>:<span class="xml"><span class="tag">&lt;<span class="name">HomeOutlined</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&#x27;/user-manage&#x27;</span>:<span class="xml"><span class="tag">&lt;<span class="name">UserOutlined</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&#x27;/user-manage/list&#x27;</span>:<span class="xml"><span class="tag">&lt;<span class="name">UserOutlined</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&#x27;/right-manage&#x27;</span>:<span class="xml"><span class="tag">&lt;<span class="name">CrownOutlined</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&#x27;/right-manage/role/list&#x27;</span>:<span class="xml"><span class="tag">&lt;<span class="name">CrownOutlined</span> /&gt;</span></span>,</span><br><span class="line">    <span class="string">&#x27;/right-manage/right/list&#x27;</span>:<span class="xml"><span class="tag">&lt;<span class="name">CrownOutlined</span> /&gt;</span></span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Issue 3, The Home is no children, we do not need the expansed icon in the right, so we have to add children.length to check<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">item.children?.length &gt; <span class="number">0</span> &amp;&amp; checkPagePermission(item)</span><br></pre></td></tr></table></figure></li>
<li>Issue 4, the style is egly, we import <code>antd.css</code> into <code>App.css</code><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;~antd/dist/antd.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line">::-webkit-scrollbar &#123;width: <span class="number">5px</span>;<span class="attribute">height</span>: <span class="number">5px</span>;<span class="attribute">position</span>:absolute&#125;</span><br><span class="line">::-webkit-scrollbar-thumb &#123;background-color: <span class="number">#1890ff</span>;&#125;</span><br><span class="line">::-webkit-scrollbar-track &#123;background-color: <span class="number">#ddd</span>;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>-Issue 5, focus the previous select menu if user refresh page.<br>Menu component have SelectedKeys and defaultOpenKeys, we can set those two field to fix our issue.<br>In Ant library, most of time, if field called defaultXXXX, that meant it is uncontrolled field, otherwise it use useState for controlling.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> location = useLocation();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> selectKeys = [location.pathname]; </span><br><span class="line"><span class="keyword">const</span> openKeys = [<span class="string">&quot;/&quot;</span> + location.pathname.split(<span class="string">&quot;/&quot;</span>)[<span class="number">1</span>]];</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">&lt;Menu theme=<span class="string">&quot;dark&quot;</span> mode=<span class="string">&quot;inline&quot;</span> selectedKeys=&#123;selectKeys&#125; defaultOpenKeys=&#123;openKeys&#125;&gt;</span><br><span class="line">                    &#123;renderMenu(menuList)&#125;</span><br><span class="line">                &lt;/Menu&gt;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/22/publish-app-to-netlify-and-heroku/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/22/publish-app-to-netlify-and-heroku/" class="post-title-link" itemprop="url">publish news-publish-management to netlify and heroku</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-22 16:01:28" itemprop="dateCreated datePublished" datetime="2021-12-22T16:01:28+00:00">2021-12-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>I am learning react at home duraing the annual leave and company holiday. I have created a repository named <a target="_blank" rel="noopener" href="https://github.com/nateliu/news-publish-management">news-publish-management</a> at <a target="_blank" rel="noopener" href="https://github.com/">GitHub</a>. </p>
<blockquote>
<p>The node version I used is <span style="color:lightblue">v16.13.1</span> <br/><br>The react version I used is <span style="color:lightblue">^17.0.2</span></p>
</blockquote>
<p>The first commit is doing following <span style="color:lightblue" bold>9</span> things:</p>
<ol>
<li>Use yarn for creating a new react app <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-app news-publish-manaments</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Yarn is a package manager for your code. It allows you to use and share code with other developers from around the world. Yarn does this quickly, securely, and reliably so you don’t ever have to worry.</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>Yarn allows you to use other developers’ solutions to different problems, making it easier for you to develop your software. If you have problems, you can report issues or contribute back on GitHub, and when the problem is fixed, you can use Yarn to keep it all up to date.</p>
</blockquote>
<blockquote>
<p>I will swith to <a target="_blank" rel="noopener" href="https://yarnpkg.com/cli/install">yarn</a> instead of npm after this learning section.</p>
</blockquote>
<ol start="2">
<li><p>Install <span style="color:lightblue">json-server</span> for deploying the <span style="color:lightblue">db.json</span> to hereku</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add json-server</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/dreyacosta/JSONServer">JSONServer</a> was stored in GitHub.</p>
</blockquote>
</li>
<li><p>Modify the <span style="color:lightblue">package.json</span>, and append below line in <span style="color:lightblue">scripts</span> selction</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;json-server&quot;</span>: <span class="string">&quot;node mock-api/server.js&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Add <span style="color:lightblue">netlify.toml</span></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch netlify.toml</span><br></pre></td></tr></table></figure>
<p>paste content into the toml file</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[build]</span></span><br><span class="line">  <span class="attr">command</span> = <span class="string">&quot;CI= npm run build&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[[redirects]]</span></span><br><span class="line">  <span class="attr">from</span> = <span class="string">&quot;/api/*&quot;</span></span><br><span class="line">  <span class="attr">to</span> = <span class="string">&quot;https://news-publish-management.herokuapp.com/api/:splat&quot;</span></span><br><span class="line">  <span class="attr">status</span> = <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="section">[[redirects]]</span></span><br><span class="line">  <span class="attr">from</span> = <span class="string">&quot;/*&quot;</span></span><br><span class="line">  <span class="attr">to</span> = <span class="string">&quot;/index.html&quot;</span></span><br><span class="line">  <span class="attr">status</span> = <span class="number">200</span></span><br></pre></td></tr></table></figure></li>
<li><p>Add <span style="color:lightblue">Procfile</span>, the detail information of ProcFile in Heroku can be foud in <a target="_blank" rel="noopener" href="https://devcenter.heroku.com/articles/procfile">here</a>. Base on this page, we can add below line in the Procfile as well.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web: npm run json-server-prod</span><br></pre></td></tr></table></figure></li>
<li><p>Create a <span style="color:lightblue">server.js</span> under <span style="color:lightblue">mock-api</span> folder.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir mock-api</span><br><span class="line">touch mock-api/server.js</span><br></pre></td></tr></table></figure>
<p>paste below content into <span style="color:lightblue">server.js</span></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonServer = <span class="built_in">require</span>(<span class="string">&quot;json-server&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> server = jsonServer.create();</span><br><span class="line"><span class="keyword">const</span> router = jsonServer.router(<span class="string">&quot;mock-api/db.json&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> middlewares = jsonServer.defaults();</span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">4000</span>; </span><br><span class="line"></span><br><span class="line">server.use(middlewares);</span><br><span class="line">server.use(<span class="string">&quot;/api&quot;</span>, router);</span><br><span class="line"></span><br><span class="line">server.listen(port);</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="7">
<li><p>Push above changs into to GitHub</p>
</li>
<li><p>Go to <a target="_blank" rel="noopener" href="https://id.heroku.com/login">Heroku</a> for deploying news-publish-managements.<br>Once it was successfully deployed. It can be verified via<br><a target="_blank" rel="noopener" href="https://news-publish-management.herokuapp.com/api/news">https://news-publish-management.herokuapp.com/api/news</a></p>
</li>
</ol>
<ol start="9">
<li>Go to <a target="_blank" rel="noopener" href="https://app.netlify.com/">netlify</a> for deploying news-publish-managements.<br>Once it was successfully deployed. It is can be verified via<br><a target="_blank" rel="noopener" href="https://news-publish-management.netlify.app/">https://news-publish-management.netlify.app/</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/21/new-hexo-blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/21/new-hexo-blog/" class="post-title-link" itemprop="url">creating a new hexo blog</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-21 11:31:31" itemprop="dateCreated datePublished" datetime="2021-12-21T11:31:31+00:00">2021-12-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Welcome to <a target="_blank" rel="noopener" href="https://nateliu.github.io/">Nate Liu’s Blog</a>! This is step by step I created this blog with <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>.</p>
<h3 id="Step-1-install-Git-and-Node"><a href="#Step-1-install-Git-and-Node" class="headerlink" title="Step 1 install Git and Node"></a>Step 1 install Git and Node</h3><p>Official Website:<br/><br><a target="_blank" rel="noopener" href="https://git-scm.com/downloads">Git</a><br/><br><a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">Node</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install git</span><br><span class="line">brew install node</span><br></pre></td></tr></table></figure>

<h3 id="Step-2-install-hexo"><a href="#Step-2-install-hexo" class="headerlink" title="Step 2 install hexo"></a>Step 2 install hexo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure>

<h3 id="Step-3-initilize-hexo-blog"><a href="#Step-3-initilize-hexo-blog" class="headerlink" title="Step 3 initilize hexo-blog"></a>Step 3 initilize hexo-blog</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo init hexo-blog</span><br><span class="line"><span class="built_in">cd</span> hexo-blog</span><br><span class="line">npm install</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>

<h3 id="Step-4-generate-html-pages"><a href="#Step-4-generate-html-pages" class="headerlink" title="Step 4 generate html pages"></a>Step 4 generate html pages</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo generate </span><br><span class="line">or</span><br><span class="line">hexo g</span><br></pre></td></tr></table></figure>

<h3 id="Step-5-testing-in-local"><a href="#Step-5-testing-in-local" class="headerlink" title="Step 5 testing in local"></a>Step 5 testing in local</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo server </span><br><span class="line">or </span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<h3 id="Step-6-deploy-into-github-io-with-One-command-deployment"><a href="#Step-6-deploy-into-github-io-with-One-command-deployment" class="headerlink" title="Step 6 deploy into github.io with One-command-deployment"></a>Step 6 deploy into github.io with One-command-deployment</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p>modify _config.yml, go to the end and add following lines:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: https://github.com/nateliu/nateliu.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<h3 id="Step-7-launch-with-following-lines"><a href="#Step-7-launch-with-following-lines" class="headerlink" title="Step 7 launch with following lines"></a>Step 7 launch with following lines</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>

<h3 id="Step-8-go-to-chrome-to-see-the-result"><a href="#Step-8-go-to-chrome-to-see-the-result" class="headerlink" title="Step 8 go to chrome to see the result."></a>Step 8 go to chrome to see the result.</h3><p>My Hexo Blog: <a target="_blank" rel="noopener" href="https://nateliu.github.io/">My-Hexo-Blog</a></p>
<h3 id="Step-9-my-source-for-hexo-blog"><a href="#Step-9-my-source-for-hexo-blog" class="headerlink" title="Step 9 my source for hexo-blog"></a>Step 9 my source for hexo-blog</h3><p><a target="_blank" rel="noopener" href="https://github.com/nateliu/hexo-blog">hexo-blog</a></p>
<h3 id="Step-10-using-GitHub-actions-automatically-deploy-hexo"><a href="#Step-10-using-GitHub-actions-automatically-deploy-hexo" class="headerlink" title="Step 10 using GitHub actions automatically deploy hexo"></a>Step 10 using GitHub actions automatically deploy hexo</h3><ol>
<li>Generate public and private keys<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> hexo-blog</span><br><span class="line">git checkout main</span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;jinliangliu@163.com&quot;</span> -f github-deploy-key -N <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>
Two files are generated in the directory:</li>
</ol>
<ul>
<li><span style="color:red">github-deploy-key.pub</span> —Public key file</li>
<li><span style="color:red">github-deploy-key</span> —Private key file<blockquote>
<p>Remember to add public and private keys to <span style="color:red">.gitignore</span> Medium!!!</p>
</blockquote>
</li>
</ul>
<ol start="2">
<li><p>GitHub adds public key<br>In GitHub, in hexo-blog project, follow the <span style="color:red">Settings-&gt;Deploye keys-&gt;Add deploy key</span> Find the corresponding page and add the public key. In this page, <span style="color:red">Title</span> You can customize it,<span style="color:red">Key </span>Add github-deploy-key.pub The contents of the document.</p>
<blockquote>
<p>Don’t copy more spaces!!!<br>Remember to check it <span style="color:red">Allow write access</span>. Otherwise, deployment will not be possible. Use below command to copy the contents into pasteboard</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pbcopy &lt; github-deploy-key.pub</span><br></pre></td></tr></table></figure></li>
<li><p>GitHub adds private key<br>In GitHub, in nateliu.github.io project, follow the <span style="color:red">Settings-&gt;Secrets-&gt;Add a new secrets</span> Find the corresponding page and add the private key. In this pageNameYou can customize it,ValueAdd github-deploy-key The contents of the document.</p>
<blockquote>
<p>Don’t copy more spaces!!!<br>Use below command to copy the contents into pasteboard</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pbcopy &lt; github-deploy-key</span><br></pre></td></tr></table></figure></li>
<li><p>Create compilation script<br>Create it in the hexo-blog branch (I’m here main branch)<span style="color:red">.github/workflows/ci.yml</span> The contents of the document are as follows:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Deploy</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">hexo-blog:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">source</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">main</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node-version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&#x27;$<span class="template-variable">&#123;&#123; matrix.node-version &#125;&#125;</span>&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">hexo</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">ACTION_DEPLOY_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DEPLOY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          mkdir -p ~/.ssh/</span></span><br><span class="line"><span class="string">          echo &quot;$ACTION_DEPLOY_KEY&quot; &gt; ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          chmod 600 ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span></span><br><span class="line"><span class="string">          git config --global user.email &quot;jinliangliu@163.com&quot;</span></span><br><span class="line"><span class="string">          git config --global user.name &quot;nateliu&quot;</span></span><br><span class="line"><span class="string">          npm install hexo-cli -g</span></span><br><span class="line"><span class="string">          npm install</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">deploy</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          hexo clean</span></span><br><span class="line"><span class="string">          hexo generate</span></span><br><span class="line"><span class="string">          hexo deploy</span></span><br></pre></td></tr></table></figure></li>
<li><p>Hexo configuration<br>Modify in project root <span style="color:red">_config.yml</span>, add deployment related content:</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: git@github.com:nateliu/nateliu.github.io.git </span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>
<blockquote>
<p>It looks like Step 6 before mentioned, but update the <span style="color:red"> repo: </span></p>
</blockquote>
<ol start="6">
<li>Verification<br>Now the hexo-blog has been integrated with GitHub actions, push the code into main branch to automatically compile and deploy. specific<br>The execution process can be performed in <span style="color:red">ActionsView</span></li>
</ol>
<h3 id="Useful-links"><a href="#Useful-links" class="headerlink" title="Useful links"></a>Useful links</h3><p><a target="_blank" rel="noopener" href="https://hexo.io/docs/github-pages">Hexo GitHub pages</a><br><a target="_blank" rel="noopener" href="https://developpaper.com/github-actions-automatically-deploy-hexo/">GitHub actions automatically deploy hexo</a><br><a target="_blank" rel="noopener" href="https://github.com/marketplace/actions/hexo-action#%F0%9F%8D%8Cexample-workflow---hexo-deploy">Hexo Action</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/20/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/20/hello-world/" class="post-title-link" itemprop="url">hello world</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-20 11:31:31" itemprop="dateCreated datePublished" datetime="2021-12-20T11:31:31+00:00">2021-12-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nate Liu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
