<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="Nate Liu&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Nate Liu&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Nate Liu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Nate Liu's Blog</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Nate Liu's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Nate Liu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/nateliu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;nateliu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jinliangliu@163.com" title="E-Mail → mailto:jinliangliu@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/21/lerna-my-github/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/21/lerna-my-github/" class="post-title-link" itemprop="url">lerna my react related projects into monorepos</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-21 10:15:22" itemprop="dateCreated datePublished" datetime="2022-01-21T10:15:22+00:00">2022-01-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Learned React for long times. And have created many repositories. But, it is not an easy way to findout if long time to used them. So I made all related react repository into my <code>best-practice-in-react</code> monorepos.<br>Here is my steps for creating lerna monorepos.</p>
<h3 id="1-Prerequisite"><a href="#1-Prerequisite" class="headerlink" title="1. Prerequisite"></a>1. Prerequisite</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn global add lerna</span><br><span class="line">mkdir best-practice-in-react</span><br><span class="line"><span class="built_in">cd</span> best-practice-in-react</span><br><span class="line">lerna init</span><br><span class="line">touch README.md</span><br></pre></td></tr></table></figure>

<p>The repository looks like below.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">best-practice-in-react/</span><br><span class="line">  packages/</span><br><span class="line">  package.json</span><br><span class="line">  lerna.json</span><br><span class="line">  README.md</span><br></pre></td></tr></table></figure>

<p>For better performance, we will go with YARN. So how do we configure YARN with Lerna?<br>It’s pretty simple! We just need to add <code>&quot;npmClient&quot;: &quot;yarn&quot;</code> to <code>lerna.json</code></p>
<h3 id="2-Using-YARN-workspaces-with-Lerna"><a href="#2-Using-YARN-workspaces-with-Lerna" class="headerlink" title="2. Using YARN workspaces with Lerna"></a>2. Using YARN workspaces with Lerna</h3><p>add <code>&quot;useWorkspaces&quot;: true</code> to <code>lerna.json</code> and in <code>package.json</code>, we need to add </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;workspaces&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;packages/*&quot;</span></span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>
<p>Once this is done, we can run command below, it is means forcefully telling Lerna to link the packages. As of now, we do not have anything under it, but we can run it to check if this setup can bootstrap and work properly.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn install</span><br><span class="line">or</span><br><span class="line">lerna bootstrap</span><br></pre></td></tr></table></figure>
<p>Because we have added <code>workspaces</code> in <code>package.json</code>, both commands above are the same.</p>
<p><del>### 3. Installing create-react-app and create-react-library<br>We will use create-react-app &amp; create-react-library to create a base for our libraries and modules.</del></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-library ui-components</span><br><span class="line">yarn create react-library common-utils</span><br><span class="line">yarn create react-app my-app</span><br></pre></td></tr></table></figure>
<p><del>I don’t know why create-library use react 16.13.1, so I changed</del></p>
<h3 id="3-Create-packages-under-in-packages-folder"><a href="#3-Create-packages-under-in-packages-folder" class="headerlink" title="3. Create packages under in packages folder"></a>3. Create packages under in packages folder</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-app todo-app-js</span><br><span class="line">lerna run start --scope todo-app-js</span><br></pre></td></tr></table></figure>
<p>We can see the React website.</p>
<p>Next we add prefix <code>@best-practice-in-reace</code> in <code>todo-app-js</code> <code>package.json</code>.</p>
<figure class="highlight plaintext"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;name&quot;: &quot;@best-practice-in-react/todo-app-js</span><br></pre></td></tr></table></figure>
<p>Then run commands in terminate</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lerna clean</span><br><span class="line">lerna run start --scop @best-practice-in-react/todo-app-js</span><br></pre></td></tr></table></figure>

<p>For convience, make a script in the <code>package.json</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;clean&quot;: &quot;lerna clean&quot;,</span><br><span class="line">  &quot;bootstrap&quot;: &quot;lerna bootstrap&quot;,  </span><br><span class="line">  &quot;start:todo-app-js&quot;: &quot;lerna run start --scope @best-practice-in-react/todo-app-js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So, the command we can run in terminal as </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn clean</span><br><span class="line">yarn bootstrap</span><br><span class="line">yarn start:todo-app-js</span><br></pre></td></tr></table></figure>

<p>Next we create another <code>typescript</code> version todo app under in <code>packages</code> folder.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-app todo-app-ts --template=typescript</span><br></pre></td></tr></table></figure>

<p>So far, both applications are created by <code>create-react-app</code>, next we can setup a react from zero.</p>
<h3 id="4-Elegant-commit"><a href="#4-Elegant-commit" class="headerlink" title="4. Elegant commit"></a>4. Elegant commit</h3><h4 id="commitizen-amp-amp-cz-lerna-changelog"><a href="#commitizen-amp-amp-cz-lerna-changelog" class="headerlink" title=". commitizen &amp;&amp; cz-lerna-changelog"></a>. commitizen &amp;&amp; cz-lerna-changelog</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add commitizen -DW</span><br><span class="line">yarn add cz-lerna-changelog -DW</span><br></pre></td></tr></table></figure>
<p><code>commitizen</code> used for formatting <code>git commit message</code>. It providers a interactive to retrieve commit message.<br><code>cz-lerna-changelog</code> used for <code>Lerna</code> commit message specifically。</p>
<p>After install both pckages, we add <code>config</code> in root <code>package.json</code>. config <code>cz-lerna-changelog</code> to <code>commitizen</code>, mean time, we have to add scripts for <code>commitizen</code> because we save them in <code>devDenpendenies</code>. So we have to add <code>scripts</code> for excuting <code>git-cz</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&quot;commit&quot;</span>: <span class="string">&quot;git-cz&quot;</span>,</span><br><span class="line">    ...</span><br><span class="line"> &#125;,</span><br><span class="line"><span class="string">&quot;config&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;commitizen&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;./node_modules/cz-lerna-changelog&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>At this time,we can use </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn commit </span><br></pre></td></tr></table></figure>
<p>to commit message with elegent. </p>
<h4 id="commitlint-amp-amp-husky"><a href="#commitlint-amp-amp-husky" class="headerlink" title=". commitlint &amp;&amp; husky"></a>. commitlint &amp;&amp; husky</h4><p>We used <code>commitizen</code> above to standardize commits, but it’s up to the developer to use <code>yarn commit</code>. What if you forget, or commit directly with <code>git commit</code>? The answer is to check the commit information at commit time, and if it doesn’t meet the requirements, then you will not commit it and will be prompted. This is done by <code>commitlint</code>, and the timing is specified by <code>husky</code>. <code>husky</code> inherits all the hooks from Git, and when the hooks are triggered, husky can block illegal commits, pushes, and so on.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add -DW @commitlint/cli @commitlint/config-conventional</span><br><span class="line">yarn add -DW husky</span><br></pre></td></tr></table></figure>
<p>Add husky config in root <code>package.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;husky&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;hooks&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;commit-msg&quot;</span>: <span class="string">&quot;commitlint -E HUSKY_GIT_PARAMS&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And add <code>commitlint.config.js</code> in root directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch commitlint.config.js</span><br></pre></td></tr></table></figure>
<p>with context:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">extends</span>: [<span class="string">&#x27;@commitlint/config-conventional&#x27;</span>] &#125;</span><br></pre></td></tr></table></figure>

<p><code>commit-msg</code> is a hook that checks the commit message when <code>git commit</code> is triggered, and will use <code>commitlit</code> to check it when triggered. If you want to commit via <code>git commit</code> or other third-party tools after installation and configuration, you will not be able to commit if the commit message does not match the specification. This constrains developers from using <code>yarn commit</code> for commits.</p>
<blockquote>
<p>We can use </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;build: change something&quot;</span> | yarn commitlint</span><br></pre></td></tr></table></figure>
<p>to Vverify that your commit message passes the commitlint check or not.</p>
</blockquote>
<h4 id="standardjs-amp-amp-lint-staged"><a href="#standardjs-amp-amp-lint-staged" class="headerlink" title=". standardjs &amp;&amp; lint-staged"></a>. standardjs &amp;&amp; lint-staged</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -DW standard lint-staged</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;husky&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;hooks&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;pre-commit&quot;</span>: <span class="string">&quot;lint-staged&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;commit-msg&quot;</span>: <span class="string">&quot;commitlint -E HUSKY_GIT_PARAMS&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;*.js&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;standard --fix&quot;</span>,</span><br><span class="line">      <span class="string">&quot;git add&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>Add the <code>lint-staged</code> configuration to root <code>package.json</code>, as shown above, to perform <code>standard --fix</code> checksum on the js files in the staging area and repair them automatically. Then when to verify it, we use <code>husky</code> installed above again, husky’s configuration add <code>pre-commit</code> hook to perform <code>lint-staged</code> verification operation, as shown above.<br>At this time, when the js file is submitted, it will automatically correct and verify the errors. This ensures uniform code style and improves code quality.</p>
<h3 id="5-npm-publish-locally：Verdaccio"><a href="#5-npm-publish-locally：Verdaccio" class="headerlink" title="5. npm publish locally：Verdaccio"></a>5. npm publish locally：Verdaccio</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn global add verdaccio</span><br><span class="line">verdaccio</span><br><span class="line">touch .npmrc</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><figcaption><span>.npmrc content</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registry=<span class="string">&quot;http://localhost:4873/&quot;</span></span><br></pre></td></tr></table></figure>
<p>It’s done! Whenever you run <code>lerna publish</code>, the package built from the child project will be published in the local npm repository, and when you run <code>lerna bootstrap</code>, <code>Verdaccio</code> will release it, allowing you to successfully pull the corresponding code from the remote npm repository.</p>
<h3 id="5-Push-this-to-github"><a href="#5-Push-this-to-github" class="headerlink" title="5. Push this to github"></a>5. Push this to github</h3><p>New a repostory in github.com, and run commands below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https://github.com/nateliu/best-practice-in-react.git</span><br><span class="line">git branch -M main</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&#x27;Initialize best-practice-in-react&#x27;</span></span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>

<h3 id="6-Import-an-existed-repository-into-this-monorepo"><a href="#6-Import-an-existed-repository-into-this-monorepo" class="headerlink" title="6. Import an existed repository into this monorepo"></a>6. Import an existed repository into this monorepo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lerna import ../react-best-practice</span><br><span class="line">lerna import ../react-component-library</span><br><span class="line">lerna import ../webpack-react-startkit</span><br><span class="line">lerna import ../webpack-redux-startkit</span><br><span class="line">lerna import ../react-redux-startkit</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/15/react-best-practice-react-source/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/15/react-best-practice-react-source/" class="post-title-link" itemprop="url">react best practice (3)-- learning source code</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-15 11:06:38" itemprop="dateCreated datePublished" datetime="2022-01-15T11:06:38+00:00">2022-01-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Try to setup react soure code learning environment.</p>
<h2 id="1-Step-1"><a href="#1-Step-1" class="headerlink" title="1. Step 1"></a>1. Step 1</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/facebook/react.git</span><br><span class="line"><span class="built_in">cd</span> react</span><br><span class="line">git branch -a</span><br><span class="line">git checkout 17.0.2</span><br><span class="line">yarn install</span><br></pre></td></tr></table></figure>

<p>According the <a target="_blank" rel="noopener" href="https://reactjs.org/docs/how-to-contribute.html#development-workflow">How to contribute</a>, next run command below</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yarn build react/index,react-dom/index --<span class="built_in">type</span>=UMD</span><br><span class="line"></span><br><span class="line"><span class="comment"># open fixtures/packaging/babel-standalone/dev.html and it used the compiled react.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> build/node_modules/react</span><br><span class="line">yarn link</span><br><span class="line"><span class="built_in">cd</span> build/node_modules/react-dom</span><br><span class="line">yarn link</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Using <code>yarn create react-app</code> to create a new project and remove dependency of <code>react</code> and <code>react-dom</code> in <code>package.json</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-app react-source-learning --template:typescript</span><br><span class="line"><span class="built_in">cd</span> react-source-learning</span><br><span class="line">yarn link react react-dom</span><br></pre></td></tr></table></figure>

<h2 id="2-Step-2"><a href="#2-Step-2" class="headerlink" title="2. Step 2"></a>2. Step 2</h2><p>Write JSX in maunally.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//jsx</span></span><br><span class="line"><span class="keyword">const</span> element = <span class="xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&#x27;title&#x27;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span>&#x27;<span class="attr">red</span>&#x27;&#125;&#125;&gt;</span> hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//babel=&gt;js function. React.createElement()=&gt;vnode</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> element2 = React.createElement(<span class="string">&quot;h1&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">className</span>: <span class="string">&quot;title&quot;</span>,</span><br><span class="line">    <span class="attr">style</span>: &#123;</span><br><span class="line">      <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="string">&quot; hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(element);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    element2,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>We can go to <a target="_blank" rel="noopener" href="https://babeljs.io/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&build=&builtIns=false&corejs=3.6&spec=false&loose=false&code_lz=DwCwjABAxgNghgZwQOTgWwKYF4DkAXASzxgxwgTwE8SsBvWqAexkYCcAuHVjAExwF9-APgggMMFsAD04IUA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=module&lineWrap=true&presets=env%2Creact%2Cstage-2&prettier=false&targets=&version=7.16.9&externalPlugins=&assumptions=%7B%7D">Babel</a> to check the <code>element</code> mentioned above. <code>element</code> is equal to <code>element2</code>.</p>
</blockquote>
<p>The process is:<br>1, <code>JSX</code> will be transferd to <code>React.createElement</code> method by <code>Babel</code><br>2, <code>React.createElement</code> is actually returned a <code>virtual node</code>.<br>3, <code>React.Render</code> will render the <code>virtual node</code> to <code>realistic dom</code></p>
<p>So next to implement a <code>createElement</code> in <code>react.js</code>.</p>
<p>And then to create a new <code>react-dom.js</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/07/react-best-practice-diff/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/07/react-best-practice-diff/" class="post-title-link" itemprop="url">react best practice (2)-- diffing, key</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-07 21:08:58" itemprop="dateCreated datePublished" datetime="2022-01-07T21:08:58+00:00">2022-01-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Today we are going to learning React diffing algorithm and key in React.  Let’s understand with below example.</p>
<h3 id="1-Diffing-algorithm"><a href="#1-Diffing-algorithm" class="headerlink" title="1. Diffing algorithm"></a>1. Diffing algorithm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir src/components/diff</span><br><span class="line">touch src/components/diff/DiffPage.tsx</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, ReactElement, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DiffPage: FC = (): <span class="function"><span class="params">ReactElement</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [dataValue, setDataValue] = useState(<span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line">    <span class="keyword">const</span> [personList, setPersonList] = useState([</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Alex&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;Allen&#x27;</span>, <span class="attr">age</span>: <span class="number">19</span> &#125;,</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> setDataValue(<span class="keyword">new</span> <span class="built_in">Date</span>()), <span class="number">1000</span>)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> addOne = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> person: Person = &#123; <span class="attr">id</span>: personList.length + <span class="number">1</span>, <span class="attr">name</span>: <span class="string">`people <span class="subst">$&#123;personList.length&#125;</span>`</span>, <span class="attr">age</span>: <span class="number">20</span> + personList.length &#125;</span><br><span class="line">        setPersonList([person, ...personList])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;diff&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    now:&#123;dataValue.toTimeString()&#125;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;key&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Person Information List<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;addOne&#125;</span>&gt;</span>Add one people<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>using index as key<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        personList.map((personObj: Person, index: number) =&gt; &#123;</span></span><br><span class="line"><span class="xml">                            return <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;personObj.name&#125;---&#123;personObj.age&#125;<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#125;)</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>using id as key<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        personList.map((personObj: Person) =&gt; &#123;</span></span><br><span class="line"><span class="xml">                            return <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;personObj.id&#125;</span>&gt;</span>&#123;personObj.name&#125;---&#123;personObj.age&#125;<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#125;)</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> DiffPage;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-DOM-vs-Virtual-DOM"><a href="#2-DOM-vs-Virtual-DOM" class="headerlink" title="2. DOM vs Virtual DOM"></a>2. DOM vs Virtual DOM</h3><p><code>DOM</code> stands for Document Object Model. It is the hierarchical representation of the web page(UI).<br><code>Virtual DOM</code> is just a copy of the original DOM kept in the memory and synced with the real DOM by libraries such as <code>ReactDOM</code>.<br>Because DOM manipulation is very slower and expensive in terms of time complexity.</p>
<p>When there is a update in the virtual DOM, react compares the virtual DOM with a snapshot of the virtual DOM taken right before the update of the virtual DOM.</p>
<p>With the help of this comparison React figures out which components in the UI needs to be updated. This process is called diffing. The algorithm that is used for the diffing process is called as the diffing algorithm.</p>
<p>Above source code will render to </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;diff&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>now:21:58:08 GMT+0800 (China Standard Time)<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;key&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Person Information List<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>Add one people<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>using index as key<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>Alex---18<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>Allen---19<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>using id as key<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>Alex---18<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>Allen---19<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>The <code>span</code> in <code>diff</code> class will change every 1 second, but another html element won’t change in this class section, that is the help from <code>diffing algorithm</code>.</li>
<li>The <code>key</code> section, if use index as key, it can’t get benifit from <code>diffing</code> because the index was changed and will force evey <code>li</code> to render it again and again. If use the id as key, the performace will revert, because the id is unique and stable for every <code>li</code>. </li>
</ul>
<blockquote>
<ul>
<li>Frequent DOM manipulations are expensive.</li>
<li>Virtual DOM is a virtual representation of DOM in memory.</li>
<li>Virtual DOM is synced with real DOM with ReactDOM library. This process is called Reconciliation.</li>
<li>React compares the Virtual DOM and pre-updated Virtual DOM and only marks the sub-tree of components that are updated. This process is called diffing.</li>
<li>The algorithm behind diffing is called Diffing algorithm.React uses keys to avoid unnecessary re-renders.</li>
</ul>
</blockquote>
<h3 id="3-React-event-parameters"><a href="#3-React-event-parameters" class="headerlink" title="3. React event parameters"></a>3. React event parameters</h3><p>Compare bind parameter in React.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir src/components/event</span><br><span class="line">touch src/components/event/ClickButton.tsx</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, ReactElement &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ClickButton: FC = (): <span class="function"><span class="params">ReactElement</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleClick = <span class="function">(<span class="params">e: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`this is passed any parameter:<span class="subst">$&#123;e&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`this is from e.id:<span class="subst">$&#123;e.target.id&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`this is e.data:<span class="subst">$&#123;e.currentTarget.getAttribute(<span class="string">&#x27;data-xxx&#x27;</span>)&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// const handleClick2 = (e: string) =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(`this is passed string parameter:$&#123;e&#125;`);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleClick3 = <span class="function">(<span class="params">e: <span class="built_in">any</span>, id: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`this is passed id:<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`this is from e.id:<span class="subst">$&#123;e.target.id&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`this is e.data:<span class="subst">$&#123;e.currentTarget.getAttribute(<span class="string">&#x27;data-xxx&#x27;</span>)&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;123&quot;</span> <span class="attr">data-xxx</span>=<span class="string">&quot;789&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                Click me1</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            &#123;/* cannot write like this: */&#125;</span></span><br><span class="line"><span class="xml">            &#123;/* <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;1234&quot;</span> <span class="attr">data-xxx</span>=<span class="string">&quot;7890&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick2(</span>&#x27;<span class="attr">123</span>&#x27;)&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                Click me2</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span> */&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;456&quot;</span> <span class="attr">data-xxx</span>=<span class="string">&quot;78900&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;(e)</span> =&gt;</span> handleClick3(e, &#x27;123456&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="xml">                Click me3</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ClickButton;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/05/react-best-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/05/react-best-practice/" class="post-title-link" itemprop="url">react best practice (1)-- useRef, forwardRef, useImperativeHandle</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-05 09:16:28" itemprop="dateCreated datePublished" datetime="2022-01-05T09:16:28+00:00">2022-01-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Learning React with hooks</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-app react-best-practice --template=typescript &amp;&amp; <span class="built_in">cd</span> react-best-practice</span><br><span class="line">mkdir src/router</span><br><span class="line">touch src/router/IndexRouter.tsx</span><br><span class="line">yarn add react-router-dom</span><br><span class="line"></span><br><span class="line">mkdir src/components</span><br><span class="line">mkdir src/components/forwardRef</span><br><span class="line">touch src/components/forwardRef/ParentPage.tsx</span><br><span class="line">touch src/components/forwardRef/ChildInput.tsx</span><br><span class="line">touch src/components/forwardRef/types.tsx</span><br></pre></td></tr></table></figure>
<h3 id="1-Parent-component-define-a-ref-and-pass-it-to-Child-componet-Child-component-is-used-React-forwardRef-to-a-real-InputWithLabel-component"><a href="#1-Parent-component-define-a-ref-and-pass-it-to-Child-componet-Child-component-is-used-React-forwardRef-to-a-real-InputWithLabel-component" class="headerlink" title="1. Parent component define a ref and pass it to Child componet, Child component is used React.forwardRef to a real InputWithLabel component."></a>1. Parent component define a ref and pass it to Child componet, Child component is used <code>React.forwardRef</code> to a real <code>InputWithLabel</code> component.</h3><ul>
<li>types.tsx<figure class="highlight typescript"><figcaption><span>types.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IChildInputProps &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IInputWithLabelProps &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">myRef</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>ParentPage.tsx<figure class="highlight typescript"><figcaption><span>ParentPage.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, ReactElement, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ChildInput <span class="keyword">from</span> <span class="string">&#x27;./ChildInput&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ParentPage: FC = (): <span class="function"><span class="params">ReactElement</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> myRef = useRef&lt;HTMLInputElement&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> node = myRef.current;</span><br><span class="line">        <span class="built_in">console</span>.log(node?.value);</span><br><span class="line">        node?.focus()</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ChildInput</span> <span class="attr">label</span>=<span class="string">&#123;</span>&quot;<span class="attr">Child</span> <span class="attr">Name</span>&quot;&#125; <span class="attr">ref</span>=<span class="string">&#123;myRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ParentPage;</span><br></pre></td></tr></table></figure></li>
<li>ChildInput.tsx<figure class="highlight typescript"><figcaption><span>ChildInput.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; forwardRef, ReactElement, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IChildInputProps, IInputWithLabelProps &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> InputWithLabel = (&#123; label, myRef &#125;: IInputWithLabelProps): <span class="function"><span class="params">ReactElement</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`message from child.value=<span class="subst">$&#123;e.target.value&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">const</span> value = e.target.value;</span><br><span class="line">        setValue(value);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;label&#125;:<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;myRef&#125;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ChildInput = forwardRef(<span class="function">(<span class="params">&#123; label &#125;: IChildInputProps, ref: <span class="built_in">any</span></span>) =&gt;</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">InputWithLabel</span> <span class="attr">label</span>=<span class="string">&#123;label&#125;</span> <span class="attr">myRef</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ChildInput;</span><br></pre></td></tr></table></figure></li>
<li>IndexRouter.tsx<figure class="highlight typescript"><figcaption><span>IndexRouter.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; ReactElement &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Route, Routes &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ParentPage <span class="keyword">from</span> <span class="string">&#x27;../components/forwardRef/ParentPage&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> IndexRouter = (): <span class="function"><span class="params">ReactElement</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/forwardRef&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">ParentPage</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> IndexRouter;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>This method will export the whole <code>ChildInput</code> to <code>ParentPage</code>, for security reason, we just want export some functions to <code>ParentPage</code>, that we can use <code>useImperativeHandler</code><br>Otherwise, for example user can write following code in <code>ParentPage</code>. Do you really want user write <code>onclick</code> event in <code>ParentPage</code> if you are the owner of <code>ChildInput</code>?</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> node = myRef.current;</span><br><span class="line">    <span class="built_in">console</span>.log(node?.value);</span><br><span class="line">    node?.focus();</span><br><span class="line">    node.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(<span class="string">&#x27;have clicked me!&#x27;</span>) &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-Add-innerRef-and-useImperativeHandle-in-real-inner-component-InputWithLabel"><a href="#2-Add-innerRef-and-useImperativeHandle-in-real-inner-component-InputWithLabel" class="headerlink" title="2. Add innerRef and  useImperativeHandle in real inner component InputWithLabel"></a>2. Add <code>innerRef</code> and  <code>useImperativeHandle</code> in real inner component <code>InputWithLabel</code></h3><ul>
<li>update <code>ChildInput.tsx</code><figure class="highlight typescript"><figcaption><span>ChildInput.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; forwardRef, ReactElement, useState, useRef, useImperativeHandle &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line">...</span><br><span class="line">    useImperativeHandle(myRef, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        getValue,</span><br><span class="line">        <span class="function"><span class="title">focus</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> node = innerRef.current;</span><br><span class="line">            node?.focus();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> getValue = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line"> &lt;input <span class="keyword">type</span>=<span class="string">&quot;text&quot;</span> ref=&#123;innerRef&#125; value=&#123;value&#125; onChange=&#123;handleChange&#125; /&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>update <code>ParentPage</code><figure class="highlight typescript"><figcaption><span>ParentPage</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myRef = useRef&lt;<span class="built_in">any</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> node = myRef.current;</span><br><span class="line">    <span class="built_in">console</span>.log(node);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`the value &#x27;<span class="subst">$&#123;node.getValue()&#125;</span>&#x27; from Child fucntion getValue()`</span>);</span><br><span class="line">    node.focus();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>From the console, when click the <code>Click</code> button, we can see only <code>getValue</code> and <code>focus</code> were exported.</p>
</blockquote>
</li>
</ul>
<h3 id="3-Delete-InputWithLabel-and-move-the-content-into-ChildInput"><a href="#3-Delete-InputWithLabel-and-move-the-content-into-ChildInput" class="headerlink" title="3. Delete InputWithLabel and move the content into ChildInput"></a>3. Delete <code>InputWithLabel</code> and move the content into <code>ChildInput</code></h3><ul>
<li>Delete <code>IInputWithLabelProps</code><figure class="highlight typescript"><figcaption><span>types.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IChildInputProps &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Update <code>ChildInput.tsx</code><figure class="highlight typescript"><figcaption><span>ChildInput.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; forwardRef, ReactElement, useState, useRef, useImperativeHandle &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IChildInputProps &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ChildInput = (&#123; label &#125;: IChildInputProps, <span class="attr">ref</span>: <span class="built_in">any</span>): <span class="function"><span class="params">ReactElement</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> innerRef = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    useImperativeHandle(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        getValue,</span><br><span class="line">        <span class="function"><span class="title">focus</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> node = innerRef.current;</span><br><span class="line">            node?.focus();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> getValue = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`message from child.value=<span class="subst">$&#123;e.target.value&#125;</span>`</span>)</span><br><span class="line">        <span class="keyword">const</span> value = e.target.value;</span><br><span class="line">        setValue(value);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;label&#125;:<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;innerRef&#125;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> forwardRef(ChildInput);</span><br></pre></td></tr></table></figure></li>
<li>No change in <code>ParentPage</code></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/30/todo-app-js-ts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/30/todo-app-js-ts/" class="post-title-link" itemprop="url">todo-app-js-ts</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-30 21:34:38" itemprop="dateCreated datePublished" datetime="2021-12-30T21:34:38+00:00">2021-12-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Use react hook to create a Todo app, and then migrate to typescript.</p>
<h3 id="1-create-todo-app-js"><a href="#1-create-todo-app-js" class="headerlink" title="1. create todo-app-js"></a>1. create todo-app-js</h3><p>I am going to perform below componets for the app, and I am going to use hooks for implement. It will contain <code>useState</code>, <code>useReducer</code>, <code>useEffect</code>, <code>useCallback</code></p>
<ul>
<li>App</li>
<li>TodoList</li>
<li>TodoInput</li>
<li>TodoItem</li>
<li>todoReducer</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-app todo-app-js</span><br><span class="line"><span class="built_in">cd</span> todo-app-js</span><br><span class="line">mkdir src/components</span><br><span class="line">touch src/components/TodoList.js</span><br><span class="line">touch src/components/TodoInput.js</span><br><span class="line">touch src/components/TodoItem.js</span><br><span class="line"></span><br><span class="line">mkdir src/reducer</span><br><span class="line">touch src/reducer/todoReducer.js</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><figcaption><span>TodoList</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useReducer, useEffect, useCallback &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> TodoInput <span class="keyword">from</span> <span class="string">&#x27;./TodoInput&#x27;</span></span><br><span class="line"><span class="keyword">import</span> TodoItem <span class="keyword">from</span> <span class="string">&#x27;./TodoItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> todoReducer <span class="keyword">from</span> <span class="string">&#x27;../reducer/todoReducer&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// comment out below line because has changed to use lazy load.</span></span><br><span class="line"><span class="comment">// const initialState:IState = &#123;</span></span><br><span class="line"><span class="comment">//     todoList:[]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">initTodoList</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">todoList</span>: initTodoList</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">TodoList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// comment out below line because has changed to use useReducer</span></span><br><span class="line">    <span class="comment">// const [todoList,setTodoList] = useState([]);</span></span><br><span class="line">    <span class="keyword">const</span> [state, dispatch] = useReducer(todoReducer, [], init)</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(state.todoList)</span></span><br><span class="line">        <span class="keyword">const</span> list = <span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;todoList&#x27;</span> || <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (list) &#123;</span><br><span class="line">            <span class="keyword">const</span> todoLists = <span class="built_in">JSON</span>.parse(list);</span><br><span class="line">            dispatch(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;INIT_TODOLIST&quot;</span>,</span><br><span class="line">                <span class="attr">payload</span>: todoLists</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;todoList&#x27;</span>, <span class="built_in">JSON</span>.stringify(state.todoList))</span><br><span class="line">    &#125;, [state.todoList])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> addTodo = useCallback(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">         <span class="comment">// comment out below line because has changed to use useReducer.</span></span><br><span class="line">        <span class="comment">// setTodoList(todoList =&gt; [...todoList,todo]);</span></span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;ADD_TODO&quot;</span>,</span><br><span class="line">            <span class="attr">payload</span>: todo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> removeTodo = useCallback(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;REMOVE_TODO&quot;</span>,</span><br><span class="line">            <span class="attr">payload</span>: id</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> toggleTodo = useCallback(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;TOGGLE_TODO&quot;</span>,</span><br><span class="line">            <span class="attr">payload</span>: id</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">TodoInput</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">addTodo</span>=<span class="string">&#123;addTodo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">todoList</span> = <span class="string">&#123;state.todoList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            /&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line"><span class="xml">                state.todoList &amp;&amp;</span></span><br><span class="line"><span class="xml">                state.todoList.map(todo =&gt; &#123;</span></span><br><span class="line"><span class="xml">                    return <span class="tag">&lt;<span class="name">TodoItem</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">todo</span>=<span class="string">&#123;todo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">removeTodo</span>=<span class="string">&#123;removeTodo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">toggleTodo</span>=<span class="string">&#123;toggleTodo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    /&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;)</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><figcaption><span>TodoInput</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">TodoInput</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> inputRef = useRef(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> handleClick = <span class="function">()=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> val = inputRef.current.value.trim();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(val.length)&#123;</span><br><span class="line">            <span class="keyword">const</span> isExist = props.todoList.find(<span class="function"><span class="params">todo</span> =&gt;</span> todo.content === val);</span><br><span class="line">            <span class="keyword">if</span>(isExist)&#123;</span><br><span class="line">                alert(<span class="string">&#x27;already exist!&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            props.addTodo(&#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="built_in">Date</span>.now(),</span><br><span class="line">                <span class="attr">content</span>:inputRef.current.value.trim(),</span><br><span class="line">                <span class="attr">completed</span>:<span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            inputRef.current.value = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>handleClick()&#125;&gt;Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><figcaption><span>TodoItem</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">TodoItem</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id, content, completed &#125; = props.todo;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span>=<span class="string">&#123;completed&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;()</span> =&gt;</span> props.toggleTodo(id)&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">textDecoration:</span> <span class="attr">completed</span> ? &#x27;<span class="attr">line-through</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">none</span>&#x27; &#125;&#125;&gt;</span>&#123;content&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> props.removeTodo(id)&#125;&gt;Delete<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><figcaption><span>todoReducer</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">todoReducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; type, payload &#125; = action;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;INIT_TODOLIST&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">todoList</span>: payload</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ADD_TODO&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">todoList</span>: [...state.todoList, payload]</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;REMOVE_TODO&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">todoList</span>: state.todoList.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.id !== payload)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;TOGGLE_TODO&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">todoList</span>: state.todoList.map(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> todo.id === payload ? &#123;</span><br><span class="line">                        ...todo,</span><br><span class="line">                        <span class="attr">completed</span>: !todo.completed</span><br><span class="line">                    &#125; : &#123;</span><br><span class="line">                        ...todo</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>!! Here I chose <code>useReducer</code> to instead of <code>useState</code>. It looks unnecessary, but if we add a new component as middle component between TodoList and TodoItem, then the <code>useReducer</code> is better than <code>useState</code>.</p>
</blockquote>
<p>Pretty easy! right？ that is javascript version, because I am a Java progromer before, I feel it is weird. I can give any parameters to our function in the writing duration. For example. How do I know <code>action</code> has <code>type</code> and <code>payload</code> if I just in <code>todoReducer</code> file？If I typo the <code>paylaod</code>, it won’t give any error in the writing duration. So next I am going to change to use <code>TypeScript</code></p>
<h3 id="2-create-todo-app-ts"><a href="#2-create-todo-app-ts" class="headerlink" title="2. create todo-app-ts"></a>2. create todo-app-ts</h3><p>The components are the same with <code>todo-app-js</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-app todo-app-ts --template=typescript</span><br><span class="line"><span class="built_in">cd</span> todo-app-ts</span><br><span class="line">mkdir src/components</span><br><span class="line">touch src/components/TodoList.tsx</span><br><span class="line">touch src/components/TodoInput.tsx</span><br><span class="line">touch src/components/TodoItem.tsx</span><br><span class="line"></span><br><span class="line">mkdir src/reducer</span><br><span class="line">touch src/reducer/todoReducer.ts</span><br></pre></td></tr></table></figure>
<blockquote>
<p>!! use <code>--template=typescript</code> to tell <code>yarn create</code> to create a typescript application.</p>
</blockquote>
<ul>
<li><p>Create a interfact as types.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir src/types</span><br><span class="line">touch src/types/todoTypes.ts</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ITodo&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">content</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">completed</span>:<span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IState&#123;</span><br><span class="line">    <span class="attr">todoList</span>: ITodo[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IAction&#123;</span><br><span class="line">    <span class="attr">type</span>: ACTION_TYPE,</span><br><span class="line">    <span class="attr">payload</span>: ITodo | ITodo[] | <span class="built_in">number</span>  <span class="comment">//payload can be array and number.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="built_in">enum</span> ACTION_TYPE&#123;</span><br><span class="line">    ADD_TODO = <span class="string">&#x27;addTodo&#x27;</span>,</span><br><span class="line">    REMOVE_TODO = <span class="string">&#x27;removeTodo&#x27;</span>,</span><br><span class="line">    TOGGLE_TODO = <span class="string">&#x27;toggleTodo&#x27;</span>,</span><br><span class="line">    INIT_TODOLIST = <span class="string">&#x27;initTodoList&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Go to <code>todoReducer.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ACTION_TYPE, IAction, IState, ITodo &#125; <span class="keyword">from</span> <span class="string">&#x27;../types/todoTypes&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">todoReducer</span>(<span class="params">state: IState, action: IAction</span>): <span class="title">IState</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="keyword">type</span>, payload &#125; = action;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> ACTION_TYPE.INIT_TODOLIST:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">todoList</span>: payload <span class="keyword">as</span> ITodo[]</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> ACTION_TYPE.ADD_TODO:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="comment">//payload as ITodo is important, otherwise typescript don&#x27;t know it is todo or id.</span></span><br><span class="line">                <span class="attr">todoList</span>: [...state.todoList, payload <span class="keyword">as</span> ITodo]</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> ACTION_TYPE.REMOVE_TODO:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">todoList</span>: state.todoList.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.id !== payload)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> ACTION_TYPE.TOGGLE_TODO:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">todoList</span>: state.todoList.map(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> todo.id === payload ? &#123;</span><br><span class="line">                        ...todo,</span><br><span class="line">                        <span class="attr">completed</span>: !todo.completed</span><br><span class="line">                    &#125; : &#123;</span><br><span class="line">                        ...todo</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Evey each component should return ReactElement. So we are not use <code>rfc</code> formatting, we are change to below formation as well</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> IProps&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> ComponentName:FC&lt;IProps&gt; = <span class="function">(<span class="params">&#123;...Iprops...&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    ....</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            ComponentName</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ComponentName;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Here we don’t need move the <code>IProps</code> to <code>src/types/</code> folder, because here the <code>IProps</code> is a spicific parameter for this component, not a common parameter. For example below <code>TodoList</code> doesn’t have <code>Props</code> and its has no <code>IProps</code> interfacte.</p>
</blockquote>
</li>
</ul>
<figure class="highlight typescript"><figcaption><span>TodoList.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; ReactElement, useReducer, useEffect, useCallback &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> todoReducer <span class="keyword">from</span> <span class="string">&#x27;../reducer/todoReducer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ACTION_TYPE, IState, ITodo &#125; <span class="keyword">from</span> <span class="string">&#x27;../types/todoTypes&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> TodoInput <span class="keyword">from</span> <span class="string">&#x27;./TodoInput&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> TodoItem <span class="keyword">from</span> <span class="string">&#x27;./TodoItem&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// comment out below line because has changed to use lazy load.</span></span><br><span class="line"><span class="comment">// const initialState:IState = &#123;</span></span><br><span class="line"><span class="comment">//     todoList:[]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">initTodoList: ITodo[]</span>):<span class="title">IState</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">todoList</span>: initTodoList</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoList: FC = (): <span class="function"><span class="params">ReactElement</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// comment out below line because has changed to use useReducer</span></span><br><span class="line">    <span class="comment">// const [todoList, setTodoList] = useState&lt;ITodo[]&gt;([]);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// comment out below line because has changed to use lazy load.</span></span><br><span class="line">    <span class="comment">// const [ state, dispatch] = useReducer(todoReducer,initialState)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// lazy load</span></span><br><span class="line">    <span class="keyword">const</span> [state, dispatch] = useReducer(todoReducer, [], init)</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(state.todoList)</span></span><br><span class="line">        <span class="keyword">const</span> list = <span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;todoList&#x27;</span> || <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (list) &#123;</span><br><span class="line">            <span class="keyword">const</span> todoLists = <span class="built_in">JSON</span>.parse(list);</span><br><span class="line">            dispatch(&#123;</span><br><span class="line">                <span class="attr">type</span>: ACTION_TYPE.INIT_TODOLIST,</span><br><span class="line">                <span class="attr">payload</span>: todoLists</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;todoList&#x27;</span>, <span class="built_in">JSON</span>.stringify(state.todoList))</span><br><span class="line">    &#125;, [state.todoList])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> addTodo = useCallback(<span class="function">(<span class="params">todo: ITodo</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// comment out below line because has changed to use useReducer</span></span><br><span class="line">        <span class="comment">// setTodoList(todoList =&gt; [...todoList,todo]);</span></span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: ACTION_TYPE.ADD_TODO,</span><br><span class="line">            <span class="attr">payload</span>: todo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> removeTodo = useCallback(<span class="function">(<span class="params">id: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: ACTION_TYPE.REMOVE_TODO,</span><br><span class="line">            <span class="attr">payload</span>: id</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> toggleTodo = useCallback(<span class="function">(<span class="params">id: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            <span class="attr">type</span>: ACTION_TYPE.TOGGLE_TODO,</span><br><span class="line">            <span class="attr">payload</span>: id</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;todo-list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">TodoInput</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">addTodo</span>=<span class="string">&#123;addTodo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">todoList</span>=<span class="string">&#123;state.todoList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            /&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line"><span class="xml">                state.todoList &amp;&amp;</span></span><br><span class="line"><span class="xml">                state.todoList.map(todo =&gt; &#123;</span></span><br><span class="line"><span class="xml">                    return <span class="tag">&lt;<span class="name">TodoItem</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">todo</span>=<span class="string">&#123;todo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">removeTodo</span>=<span class="string">&#123;removeTodo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">toggleTodo</span>=<span class="string">&#123;toggleTodo&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    /&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;)</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> TodoList;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>TodoList</code> did all the logics, we assume <code>TodoInput</code> and <code>TodoItem</code> are child components.</p>
<figure class="highlight typescript"><figcaption><span>TodoInput</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, ReactElement, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ITodo &#125; <span class="keyword">from</span> <span class="string">&#x27;../types/todoTypes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IProps &#123;</span><br><span class="line">    <span class="attr">addTodo</span>: <span class="function">(<span class="params">todo: ITodo</span>) =&gt;</span> <span class="built_in">void</span>,</span><br><span class="line">    <span class="attr">todoList</span>: ITodo[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoInput: FC&lt;IProps&gt; = (&#123; addTodo, todoList &#125;): <span class="function"><span class="params">ReactElement</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> inputRef = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> addItem = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> val: <span class="built_in">string</span> = inputRef.current!.value.trim();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (val.length) &#123;</span><br><span class="line">            <span class="keyword">const</span> isExist = todoList.find(<span class="function"><span class="params">todo</span> =&gt;</span> todo.content === val);</span><br><span class="line">            <span class="keyword">if</span> (isExist) &#123;</span><br><span class="line">                alert(<span class="string">&#x27;already exist!&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            addTodo(&#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line">                <span class="attr">content</span>: val,</span><br><span class="line">                <span class="attr">completed</span>: <span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            inputRef.current!.value = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;addItem&#125;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> TodoInput</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Because we have pointed the <code>props.addTodo</code> as <code>addTodo</code> in the definition. So here we can just use <code>addTodo</code>.</p>
</blockquote>
</li>
<li><p>Go to <code>TodoItem</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, ReactElement &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ITodo &#125; <span class="keyword">from</span> <span class="string">&#x27;../types/todoTypes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IProps &#123;</span><br><span class="line">    <span class="attr">todo</span>: ITodo,</span><br><span class="line">    <span class="attr">toggleTodo</span>: <span class="function">(<span class="params">id: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>,</span><br><span class="line">    <span class="attr">removeTodo</span>: <span class="function">(<span class="params">id: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoItem: FC&lt;IProps&gt; = (&#123; todo, toggleTodo, removeTodo &#125;): <span class="function"><span class="params">ReactElement</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id, content, completed &#125; = todo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span>=<span class="string">&#123;completed&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;()</span> =&gt;</span> toggleTodo(id)&#125; /&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">textDecoration:</span> <span class="attr">completed</span> ? &#x27;<span class="attr">line-through</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">none</span>&#x27; &#125;&#125;&gt;</span>&#123;content&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> removeTodo(id)&#125;&gt;Delete<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> TodoItem;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-setup-environtment-from-0"><a href="#3-setup-environtment-from-0" class="headerlink" title="3. setup environtment from 0"></a>3. setup environtment from 0</h3><ul>
<li>Initialize <code>todo-app-self</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir todo-app-self </span><br><span class="line"><span class="built_in">cd</span> todo-app-self</span><br><span class="line">yarn init</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;todo-app-self&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;source of typescript&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;src/index.tsx&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;Nate Liu&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If use <code>yarn init -y</code> then the package.json will without <code>author</code> and <code>description</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir src</span><br><span class="line">touch src/index.ts</span><br><span class="line">mkdir src/components</span><br><span class="line">touch src/components/TodoList.tsx</span><br><span class="line">touch src/components/TodoInput.tsx</span><br><span class="line">touch src/components/TodoItem.tsx</span><br><span class="line"></span><br><span class="line">mkdir src/reducer</span><br><span class="line">touch src/reducer/todoReducer.ts</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>Add typescript and tslint globally<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn global add typescript tslint</span><br><span class="line">tsc --init</span><br></pre></td></tr></table></figure>
this will generate a <code>tsconfig.json</code> in the root projct.<blockquote>
<p>!!<code>yarn global add xxx</code> is not equal <code>yarn add global xxx</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack webpack-cli webpack-dev-server</span><br><span class="line">mkdir build</span><br><span class="line">touch build/webpack.config.js</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">cconst path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.tsx&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">extensions</span>: [<span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">                use: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">                <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devtool</span>: process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span> ? <span class="literal">false</span> : <span class="string">&#x27;inline-source-map&#x27;</span>,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">client</span>: &#123;</span><br><span class="line">            <span class="attr">overlay</span>: &#123;</span><br><span class="line">                <span class="attr">errors</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">static</span>: path.join(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">compress</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="number">3000</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/template/index.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
According to this <code>webpack.config.js</code>,we also need to add files as below:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yarn add path html-webpack-plugin clean-webpack-plugin ts-loader</span><br><span class="line"></span><br><span class="line">mkdir src/template</span><br><span class="line">touch src/template/index.html</span><br><span class="line"></span><br><span class="line">yarn add typescript</span><br></pre></td></tr></table></figure>
template file content is<figure class="highlight html"><figcaption><span>index.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Todo-App-Self<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>Go back <code>package.json</code>, and add <code>scripts</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=development webpack-dev-server --config ./build/webpack.config.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=production webpack --config ./build/webpack.config.js&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here we used <code>cross-env</code>, so </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add cross-env</span><br></pre></td></tr></table></figure>
<p>Go to <code>index.tsx</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Hello, Webpack&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>by now, when run below command, you will see <code>Hello, Webpack</code> in console.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn start</span><br></pre></td></tr></table></figure>

<p>Because we need <code>react</code>, it also need add following libraries.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add react react-dom @types/react @types/react-dom</span><br></pre></td></tr></table></figure>
<p>The <code>package.json</code> looks like as below:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;todo-app-self&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;source of typescript&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;src/index.tsx&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=development webpack-dev-server --config ./build/webpack.config.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=production webpack --config ./build/webpack.config.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;Nate Liu&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@types/react&quot;</span>: <span class="string">&quot;^17.0.38&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@types/react-dom&quot;</span>: <span class="string">&quot;^17.0.11&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;clean-webpack-plugin&quot;</span>: <span class="string">&quot;^4.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cross-env&quot;</span>: <span class="string">&quot;^7.0.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;html-webpack-plugin&quot;</span>: <span class="string">&quot;^5.5.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;^0.12.7&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;react&quot;</span>: <span class="string">&quot;^17.0.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;react-dom&quot;</span>: <span class="string">&quot;^17.0.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;ts-loader&quot;</span>: <span class="string">&quot;^9.2.6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span>: <span class="string">&quot;^4.5.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack&quot;</span>: <span class="string">&quot;^5.65.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^4.9.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack-dev-server&quot;</span>: <span class="string">&quot;^4.7.2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Most of content in <code>tsconfig.json</code> doesn’t need to modify, but only one jsx from <code>preserve</code> to <code>react</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;jsx&quot;</span>: <span class="string">&quot;react&quot;</span>, </span><br></pre></td></tr></table></figure>
<p>In my experience, it looks like</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">/* Visit https://aka.ms/tsconfig.json to read more about this file */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Projects */</span></span><br><span class="line">    <span class="comment">// &quot;incremental&quot;: true,                              /* Enable incremental compilation */</span></span><br><span class="line">    <span class="comment">// &quot;composite&quot;: true,                                /* Enable constraints that allow a TypeScript project to be used with project references. */</span></span><br><span class="line">    <span class="comment">// &quot;tsBuildInfoFile&quot;: &quot;./&quot;,                          /* Specify the folder for .tsbuildinfo incremental compilation files. */</span></span><br><span class="line">    <span class="comment">// &quot;disableSourceOfProjectReferenceRedirect&quot;: true,  /* Disable preferring source files instead of declaration files when referencing composite projects */</span></span><br><span class="line">    <span class="comment">// &quot;disableSolutionSearching&quot;: true,                 /* Opt a project out of multi-project reference checking when editing. */</span></span><br><span class="line">    <span class="comment">// &quot;disableReferencedProjectLoad&quot;: true,             /* Reduce the number of projects loaded automatically by TypeScript. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Language and Environment */</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es2016&quot;</span>,                                  <span class="comment">/* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */</span></span><br><span class="line">    <span class="comment">// &quot;lib&quot;: [],                                        /* Specify a set of bundled library declaration files that describe the target runtime environment. */</span></span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span>: <span class="string">&quot;react&quot;</span>,                                <span class="comment">/* Specify what JSX code is generated. */</span></span><br><span class="line">    <span class="comment">// &quot;experimentalDecorators&quot;: true,                   /* Enable experimental support for TC39 stage 2 draft decorators. */</span></span><br><span class="line">    <span class="comment">// &quot;emitDecoratorMetadata&quot;: true,                    /* Emit design-type metadata for decorated declarations in source files. */</span></span><br><span class="line">    <span class="comment">// &quot;jsxFactory&quot;: &quot;&quot;,                                 /* Specify the JSX factory function used when targeting React JSX emit, e.g. &#x27;React.createElement&#x27; or &#x27;h&#x27; */</span></span><br><span class="line">    <span class="comment">// &quot;jsxFragmentFactory&quot;: &quot;&quot;,                         /* Specify the JSX Fragment reference used for fragments when targeting React JSX emit e.g. &#x27;React.Fragment&#x27; or &#x27;Fragment&#x27;. */</span></span><br><span class="line">    <span class="comment">// &quot;jsxImportSource&quot;: &quot;&quot;,                            /* Specify module specifier used to import the JSX factory functions when using `jsx: react-jsx*`.` */</span></span><br><span class="line">    <span class="comment">// &quot;reactNamespace&quot;: &quot;&quot;,                             /* Specify the object invoked for `createElement`. This only applies when targeting `react` JSX emit. */</span></span><br><span class="line">    <span class="comment">// &quot;noLib&quot;: true,                                    /* Disable including any library files, including the default lib.d.ts. */</span></span><br><span class="line">    <span class="comment">// &quot;useDefineForClassFields&quot;: true,                  /* Emit ECMAScript-standard-compliant class fields. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Modules */</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,                                <span class="comment">/* Specify what module code is generated. */</span></span><br><span class="line">    <span class="comment">// &quot;rootDir&quot;: &quot;./&quot;,                                  /* Specify the root folder within your source files. */</span></span><br><span class="line">    <span class="comment">// &quot;moduleResolution&quot;: &quot;node&quot;,                       /* Specify how TypeScript looks up a file from a given module specifier. */</span></span><br><span class="line">    <span class="comment">// &quot;baseUrl&quot;: &quot;./&quot;,                                  /* Specify the base directory to resolve non-relative module names. */</span></span><br><span class="line">    <span class="comment">// &quot;paths&quot;: &#123;&#125;,                                      /* Specify a set of entries that re-map imports to additional lookup locations. */</span></span><br><span class="line">    <span class="comment">// &quot;rootDirs&quot;: [],                                   /* Allow multiple folders to be treated as one when resolving modules. */</span></span><br><span class="line">    <span class="comment">// &quot;typeRoots&quot;: [],                                  /* Specify multiple folders that act like `./node_modules/@types`. */</span></span><br><span class="line">    <span class="comment">// &quot;types&quot;: [],                                      /* Specify type package names to be included without being referenced in a source file. */</span></span><br><span class="line">    <span class="comment">// &quot;allowUmdGlobalAccess&quot;: true,                     /* Allow accessing UMD globals from modules. */</span></span><br><span class="line">    <span class="comment">// &quot;resolveJsonModule&quot;: true,                        /* Enable importing .json files */</span></span><br><span class="line">    <span class="comment">// &quot;noResolve&quot;: true,                                /* Disallow `import`s, `require`s or `&lt;reference&gt;`s from expanding the number of files TypeScript should add to a project. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JavaScript Support */</span></span><br><span class="line">    <span class="comment">// &quot;allowJs&quot;: true,                                  /* Allow JavaScript files to be a part of your program. Use the `checkJS` option to get errors from these files. */</span></span><br><span class="line">    <span class="comment">// &quot;checkJs&quot;: true,                                  /* Enable error reporting in type-checked JavaScript files. */</span></span><br><span class="line">    <span class="comment">// &quot;maxNodeModuleJsDepth&quot;: 1,                        /* Specify the maximum folder depth used for checking JavaScript files from `node_modules`. Only applicable with `allowJs`. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Emit */</span></span><br><span class="line">    <span class="comment">// &quot;declaration&quot;: true,                              /* Generate .d.ts files from TypeScript and JavaScript files in your project. */</span></span><br><span class="line">    <span class="comment">// &quot;declarationMap&quot;: true,                           /* Create sourcemaps for d.ts files. */</span></span><br><span class="line">    <span class="comment">// &quot;emitDeclarationOnly&quot;: true,                      /* Only output d.ts files and not JavaScript files. */</span></span><br><span class="line">    <span class="comment">// &quot;sourceMap&quot;: true,                                /* Create source map files for emitted JavaScript files. */</span></span><br><span class="line">    <span class="comment">// &quot;outFile&quot;: &quot;./&quot;,                                  /* Specify a file that bundles all outputs into one JavaScript file. If `declaration` is true, also designates a file that bundles all .d.ts output. */</span></span><br><span class="line">    <span class="comment">// &quot;outDir&quot;: &quot;./&quot;,                                   /* Specify an output folder for all emitted files. */</span></span><br><span class="line">    <span class="comment">// &quot;removeComments&quot;: true,                           /* Disable emitting comments. */</span></span><br><span class="line">    <span class="comment">// &quot;noEmit&quot;: true,                                   /* Disable emitting files from a compilation. */</span></span><br><span class="line">    <span class="comment">// &quot;importHelpers&quot;: true,                            /* Allow importing helper functions from tslib once per project, instead of including them per-file. */</span></span><br><span class="line">    <span class="comment">// &quot;importsNotUsedAsValues&quot;: &quot;remove&quot;,               /* Specify emit/checking behavior for imports that are only used for types */</span></span><br><span class="line">    <span class="comment">// &quot;downlevelIteration&quot;: true,                       /* Emit more compliant, but verbose and less performant JavaScript for iteration. */</span></span><br><span class="line">    <span class="comment">// &quot;sourceRoot&quot;: &quot;&quot;,                                 /* Specify the root path for debuggers to find the reference source code. */</span></span><br><span class="line">    <span class="comment">// &quot;mapRoot&quot;: &quot;&quot;,                                    /* Specify the location where debugger should locate map files instead of generated locations. */</span></span><br><span class="line">    <span class="comment">// &quot;inlineSourceMap&quot;: true,                          /* Include sourcemap files inside the emitted JavaScript. */</span></span><br><span class="line">    <span class="comment">// &quot;inlineSources&quot;: true,                            /* Include source code in the sourcemaps inside the emitted JavaScript. */</span></span><br><span class="line">    <span class="comment">// &quot;emitBOM&quot;: true,                                  /* Emit a UTF-8 Byte Order Mark (BOM) in the beginning of output files. */</span></span><br><span class="line">    <span class="comment">// &quot;newLine&quot;: &quot;crlf&quot;,                                /* Set the newline character for emitting files. */</span></span><br><span class="line">    <span class="comment">// &quot;stripInternal&quot;: true,                            /* Disable emitting declarations that have `@internal` in their JSDoc comments. */</span></span><br><span class="line">    <span class="comment">// &quot;noEmitHelpers&quot;: true,                            /* Disable generating custom helper functions like `__extends` in compiled output. */</span></span><br><span class="line">    <span class="comment">// &quot;noEmitOnError&quot;: true,                            /* Disable emitting files if any type checking errors are reported. */</span></span><br><span class="line">    <span class="comment">// &quot;preserveConstEnums&quot;: true,                       /* Disable erasing `const enum` declarations in generated code. */</span></span><br><span class="line">    <span class="comment">// &quot;declarationDir&quot;: &quot;./&quot;,                           /* Specify the output directory for generated declaration files. */</span></span><br><span class="line">    <span class="comment">// &quot;preserveValueImports&quot;: true,                     /* Preserve unused imported values in the JavaScript output that would otherwise be removed. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Interop Constraints */</span></span><br><span class="line">    <span class="comment">// &quot;isolatedModules&quot;: true,                          /* Ensure that each file can be safely transpiled without relying on other imports. */</span></span><br><span class="line">    <span class="comment">// &quot;allowSyntheticDefaultImports&quot;: true,             /* Allow &#x27;import x from y&#x27; when a module doesn&#x27;t have a default export. */</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>,                             <span class="comment">/* Emit additional JavaScript to ease support for importing CommonJS modules. This enables `allowSyntheticDefaultImports` for type compatibility. */</span></span><br><span class="line">    <span class="comment">// &quot;preserveSymlinks&quot;: true,                         /* Disable resolving symlinks to their realpath. This correlates to the same flag in node. */</span></span><br><span class="line">    <span class="attr">&quot;forceConsistentCasingInFileNames&quot;</span>: <span class="literal">true</span>,            <span class="comment">/* Ensure that casing is correct in imports. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Type Checking */</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span>: <span class="literal">true</span>,                                      <span class="comment">/* Enable all strict type-checking options. */</span></span><br><span class="line">    <span class="comment">// &quot;noImplicitAny&quot;: true,                            /* Enable error reporting for expressions and declarations with an implied `any` type.. */</span></span><br><span class="line">    <span class="comment">// &quot;strictNullChecks&quot;: true,                         /* When type checking, take into account `null` and `undefined`. */</span></span><br><span class="line">    <span class="comment">// &quot;strictFunctionTypes&quot;: true,                      /* When assigning functions, check to ensure parameters and the return values are subtype-compatible. */</span></span><br><span class="line">    <span class="comment">// &quot;strictBindCallApply&quot;: true,                      /* Check that the arguments for `bind`, `call`, and `apply` methods match the original function. */</span></span><br><span class="line">    <span class="comment">// &quot;strictPropertyInitialization&quot;: true,             /* Check for class properties that are declared but not set in the constructor. */</span></span><br><span class="line">    <span class="comment">// &quot;noImplicitThis&quot;: true,                           /* Enable error reporting when `this` is given the type `any`. */</span></span><br><span class="line">    <span class="comment">// &quot;useUnknownInCatchVariables&quot;: true,               /* Type catch clause variables as &#x27;unknown&#x27; instead of &#x27;any&#x27;. */</span></span><br><span class="line">    <span class="comment">// &quot;alwaysStrict&quot;: true,                             /* Ensure &#x27;use strict&#x27; is always emitted. */</span></span><br><span class="line">    <span class="comment">// &quot;noUnusedLocals&quot;: true,                           /* Enable error reporting when a local variables aren&#x27;t read. */</span></span><br><span class="line">    <span class="comment">// &quot;noUnusedParameters&quot;: true,                       /* Raise an error when a function parameter isn&#x27;t read */</span></span><br><span class="line">    <span class="comment">// &quot;exactOptionalPropertyTypes&quot;: true,               /* Interpret optional property types as written, rather than adding &#x27;undefined&#x27;. */</span></span><br><span class="line">    <span class="comment">// &quot;noImplicitReturns&quot;: true,                        /* Enable error reporting for codepaths that do not explicitly return in a function. */</span></span><br><span class="line">    <span class="comment">// &quot;noFallthroughCasesInSwitch&quot;: true,               /* Enable error reporting for fallthrough cases in switch statements. */</span></span><br><span class="line">    <span class="comment">// &quot;noUncheckedIndexedAccess&quot;: true,                 /* Include &#x27;undefined&#x27; in index signature results */</span></span><br><span class="line">    <span class="comment">// &quot;noImplicitOverride&quot;: true,                       /* Ensure overriding members in derived classes are marked with an override modifier. */</span></span><br><span class="line">    <span class="comment">// &quot;noPropertyAccessFromIndexSignature&quot;: true,       /* Enforces using indexed accessors for keys declared using an indexed type */</span></span><br><span class="line">    <span class="comment">// &quot;allowUnusedLabels&quot;: true,                        /* Disable error reporting for unused labels. */</span></span><br><span class="line">    <span class="comment">// &quot;allowUnreachableCode&quot;: true,                     /* Disable error reporting for unreachable code. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Completeness */</span></span><br><span class="line">    <span class="comment">// &quot;skipDefaultLibCheck&quot;: true,                      /* Skip type checking .d.ts files that are included with TypeScript. */</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span>: <span class="literal">true</span>                                 <span class="comment">/* Skip type checking all .d.ts files. */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>webpack official site is <a target="_blank" rel="noopener" href="https://webpack.js.org/concepts/">here</a>, if has any problem, the better thing is to visit official site to get guideline.</p>
</blockquote>
<ul>
<li>Copy todo-app-ts files to this project. and it will has same result.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/29/npm-update-fixing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/29/npm-update-fixing/" class="post-title-link" itemprop="url">news-pubish-management(11)--Update and Fixing</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-29 11:12:29" itemprop="dateCreated datePublished" datetime="2021-12-29T11:12:29+00:00">2021-12-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Will update and fix issue in this document.</p>
<h2 id="Update-Section"><a href="#Update-Section" class="headerlink" title="Update Section"></a>Update Section</h2><h3 id="1-Change-HashRouter-to-BrowserRouter"><a href="#1-Change-HashRouter-to-BrowserRouter" class="headerlink" title="1. Change HashRouter to BrowserRouter"></a>1. Change HashRouter to BrowserRouter</h3><p>In previous, the NPM uses HashRouter, it is fine, but has # in the Browser, If you don’t like the # in urls like me, then please change to BrowserRouter. For changing to BrowserRouter, every <a href=''> should remove # from href property. I guess this is the biggest different bewteen HashRouter and BrowserRouter.</p>
<h2 id="Fixing-Section"><a href="#Fixing-Section" class="headerlink" title="Fixing Section"></a>Fixing Section</h2><h3 id="1-How-to-fix-“React-Hook-useEffect-has-a-missing-dependency-Either-include-it-or-remove-the-dependency-array”-problem"><a href="#1-How-to-fix-“React-Hook-useEffect-has-a-missing-dependency-Either-include-it-or-remove-the-dependency-array”-problem" class="headerlink" title="1. How to fix “React Hook useEffect has a missing dependency. Either include it or remove the dependency array” problem?"></a>1. How to fix “React Hook useEffect has a missing dependency. Either include it or remove the dependency array” problem?</h3><p>I have a code-snippet in Home.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    axios.get(<span class="string">`/api/news?publisthState=2&amp;_expand=category`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        setAllList(res.data);</span><br><span class="line">        <span class="keyword">const</span> viewData = _.groupBy(res.data, <span class="function"><span class="params">item</span> =&gt;</span> item.category.title);</span><br><span class="line">        renderBarView(viewData)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.onresize = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, []); <span class="comment">// eslint-disable-line react-hooks/exhaustive-deps</span></span><br></pre></td></tr></table></figure>
<p>If I did’t add last line of the comment, it will occcure a  warning messge. That because the renderBarView is a function. The hook useEffect cann’t do like this, it will run on every re-render and will give a loop of re-render error. So the solution to resolve this waning are 2 options: one is above I did. Another is copy the renderBarView into useEffect. like below</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> renderBarView = <span class="function"><span class="params">vieewData</span> =&gt;</span> &#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="In-Loign-components-after-clicked-Sign-In-button-it-had-executed-the-navigate-‘-‘-but-didn’t-redirect"><a href="#In-Loign-components-after-clicked-Sign-In-button-it-had-executed-the-navigate-‘-‘-but-didn’t-redirect" class="headerlink" title="In Loign components, after clicked Sign In button, it had executed the navigate(‘/‘), but didn’t redirect."></a>In Loign components, after clicked Sign In button, it had executed the navigate(‘/‘), but didn’t redirect.</h3><p>The root cause is navigate has 2 signature, if use <Link> like above, it is must required NavigateOptions. So change to below code can fix this issue.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigate(&#x27;/&#x27;, &#123;replace:true&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="3-Audit-usage-of-navigator-userAgent-navigator-appVersion-and-navigator-platform"><a href="#3-Audit-usage-of-navigator-userAgent-navigator-appVersion-and-navigator-platform" class="headerlink" title="3. Audit usage of navigator.userAgent, navigator.appVersion, and navigator.platform"></a>3. Audit usage of navigator.userAgent, navigator.appVersion, and navigator.platform</h3><p>Found there are some codes like below:</p>
<pre><code class="javascript">// Mock not supported chrome.* API for Firefox and Electron
window.isElectron = window.navigator &amp;&amp; window.navigator.userAgent.indexOf(&#39;Electron&#39;) !== -1;
var isFirefox = navigator.userAgent.indexOf(&#39;Firefox&#39;) !== -1; // Background page only
</code></pre>
<p>definitely, they are from node_modules but not sure which library. So it wont fix right now. Detail message can be found in <a target="_blank" rel="noopener" href="https://blog.chromium.org/2021/05/update-on-user-agent-string-reduction.html">here</a></p>
<p>…To be continue….</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/29/npm-i18n/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/29/npm-i18n/" class="post-title-link" itemprop="url">news-pubish-management(10)--Internationalization</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-29 08:13:13" itemprop="dateCreated datePublished" datetime="2021-12-29T08:13:13+00:00">2021-12-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>I am going to localize the news-publish-management with <a target="_blank" rel="noopener" href="https://react.i18next.com/">react-i18next</a>.</p>
<h3 id="1-config-react-i18next"><a href="#1-config-react-i18next" class="headerlink" title="1. config react-i18next"></a>1. config react-i18next</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-i18next i18next</span><br><span class="line">mkdir src/i18n</span><br><span class="line">touch src/i18n/config.js</span><br><span class="line">touch src/i18n/en.json</span><br><span class="line">touch src/i18n/zh.json</span><br></pre></td></tr></table></figure>
<p>content in config.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> i18n <span class="keyword">from</span> <span class="string">&#x27;i18next&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; initReactI18next &#125; <span class="keyword">from</span> <span class="string">&#x27;react-i18next&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> translation_en <span class="keyword">from</span> <span class="string">&#x27;./en.json&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> translation_zh <span class="keyword">from</span> <span class="string">&#x27;./zh.json&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> resources = &#123;</span><br><span class="line">    <span class="attr">en</span>: &#123;</span><br><span class="line">        <span class="attr">translation</span>: translation_en,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">zh</span>: &#123;</span><br><span class="line">        <span class="attr">translation</span>: translation_zh,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">i18n.use(initReactI18next).init(&#123;</span><br><span class="line">    resources,</span><br><span class="line">    <span class="attr">lng</span>: <span class="string">&#x27;zh&#x27;</span>,</span><br><span class="line">    <span class="attr">interpolation</span>: &#123;</span><br><span class="line">        <span class="attr">escapeValue</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> i18n;</span><br></pre></td></tr></table></figure>

<p>en.json add content</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;Login&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;News Publish Management&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;signin&quot;</span>:<span class="string">&quot;Sign In&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;validateUserName&quot;</span>: <span class="string">&quot;Please input your Username!&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;validatePassword&quot;</span>: <span class="string">&quot;Please input your Password!&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;validateLanguage&quot;</span>: <span class="string">&quot;Please select your Language!&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;validateErrorMessage&quot;</span>: <span class="string">&quot;UserName or Password is wrong!&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;TopHeader&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;languageTitle&quot;</span>: <span class="string">&quot;Language&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;welcomeMessage&quot;</span>: <span class="string">&quot;Welcome&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;signout&quot;</span>:<span class="string">&quot;Sign Out&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>zh.json add content</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;Login&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;全球新闻发布系统&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;signin&quot;</span>:<span class="string">&quot;登陆&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;validateUserName&quot;</span>: <span class="string">&quot;请输入正确用户名!&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;validatePassword&quot;</span>: <span class="string">&quot;请输入正确的密码!&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;validateLanguage&quot;</span>: <span class="string">&quot;请选择语言!&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;validateErrorMessage&quot;</span>: <span class="string">&quot;用户名或密码不正确!&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;TopHeader&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;languageTitle&quot;</span>: <span class="string">&quot;语言&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;welcomeMessage&quot;</span>: <span class="string">&quot;欢迎&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;signout&quot;</span>:<span class="string">&quot;退出&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>import config in index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./i18n/config&#x27;</span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-Using-useTranslation-in-Login-component"><a href="#2-Using-useTranslation-in-Login-component" class="headerlink" title="2. Using useTranslation in Login component"></a>2. Using useTranslation in Login component</h3><p>Go to Login.js, import i18n and use useTranslation/Trans Hoc to do translate.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useTranslation, Trans &#125; <span class="keyword">from</span> <span class="string">&#x27;react-i18next&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> i18n <span class="keyword">from</span> <span class="string">&#x27;i18next&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> [language, setLanguage] = useState(<span class="string">&#x27;zh&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; t &#125; = useTranslation();</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">message.error(t(<span class="string">&#x27;Login.validateErrorMessage&#x27;</span>))</span><br><span class="line">...</span><br><span class="line">&lt;div className=<span class="string">&#x27;loginTitle&#x27;</span>&gt; <span class="xml"><span class="tag">&lt;<span class="name">Trans</span>&gt;</span>login.title<span class="tag">&lt;/<span class="name">Trans</span>&gt;</span></span>&lt;/div&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// support user to select his prefer language</span></span><br><span class="line"></span><br><span class="line">    &lt;Form.Item</span><br><span class="line">        name=<span class="string">&quot;language&quot;</span></span><br><span class="line">        rules=&#123;[&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: t(<span class="string">&#x27;Login.validateLanguage&#x27;</span>) &#125;]&#125;</span><br><span class="line">    &gt;</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Select</span> <span class="attr">value</span>=<span class="string">&#123;language&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleLanguageChange&#125;</span> <span class="attr">placeholder</span>=<span class="string">&#123;</span>&lt;<span class="attr">GlobalOutlined</span> <span class="attr">className</span>=<span class="string">&quot;site-form-item-icon&quot;</span> /&gt;</span>&#125; &gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#x27;zh&#x27;</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Option</span> <span class="attr">value</span>=<span class="string">&#x27;en&#x27;</span>&gt;</span>English<span class="tag">&lt;/<span class="name">Option</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span></span><br><span class="line">    &lt;/Form.Item&gt;</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">const</span> handleLanguageChange = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(`selected $&#123;value&#125;`);</span></span><br><span class="line">        setLanguage(value);</span><br><span class="line">        i18n.changeLanguage(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-Localize-in-TopHeader-component"><a href="#3-Localize-in-TopHeader-component" class="headerlink" title="3. Localize in TopHeader component"></a>3. Localize in TopHeader component</h3><p>Just use useTranslation hook in this component.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> &#123; useTranslation &#125; <span class="keyword">from</span> <span class="string">&#x27;react-i18next&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> i18n <span class="keyword">from</span> <span class="string">&#x27;i18next&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> &#123; t &#125; = useTranslation();</span><br><span class="line"><span class="keyword">const</span> handleLanguageClick = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">i18n.changeLanguage(value);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;Menu.SubMenu key=<span class="string">&quot;lngMenu&quot;</span> icon=&#123;<span class="xml"><span class="tag">&lt;<span class="name">GlobalOutlined</span> /&gt;</span></span>&#125; title=&#123;t(<span class="string">&#x27;TopHeader.languageTitle&#x27;</span>)&#125;&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&quot;lngMenuZH&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleLanguageClick(&#x27;zh&#x27;)&#125;&gt;中文<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">key</span>=<span class="string">&quot;lngMenuEN&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleLanguageClick(&#x27;en&#x27;)&#125;&gt;English<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br><span class="line">&lt;/Menu.SubMenu&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Menu.Item</span> <span class="attr">danger</span> <span class="attr">key</span>=<span class="string">&#x27;loginOutMenu&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">    localStorage.removeItem(&#x27;token&#x27;);</span></span><br><span class="line"><span class="xml">    navigate(&#x27;/login&#x27;);</span></span><br><span class="line"><span class="xml">&#125;&#125;&gt;&#123;t(&#x27;TopHeader.signout&#x27;)&#125;<span class="tag">&lt;/<span class="name">Menu.Item</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/28/npm-guest-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/28/npm-guest-system/" class="post-title-link" itemprop="url">news-pubish-management(9)--guest system</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-28 19:38:59" itemprop="dateCreated datePublished" datetime="2021-12-28T19:38:59+00:00">2021-12-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This section we are going to finish the guest system.</p>
<h3 id="1-create-a-guest-system-inforstructor"><a href="#1-create-a-guest-system-inforstructor" class="headerlink" title="1. create a guest system inforstructor."></a>1. create a guest system inforstructor.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir src/views/news</span><br><span class="line">touch src/views/news/News.js</span><br><span class="line">touch src/views/news/Detail.js</span><br></pre></td></tr></table></figure>
<p>rfc create those 2 components. Go to IndexRouter.js. add 2 routes.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">&#x27;../views/news/Detail&#x27;</span></span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&#x27;../views/news/News&#x27;</span></span><br><span class="line">...</span><br><span class="line">&lt;Route path=<span class="string">&quot;/news&quot;</span> element=&#123;<span class="xml"><span class="tag">&lt;<span class="name">News</span> /&gt;</span></span>&#125; /&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/detail/:id&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Detail</span> /&gt;</span>&#125; /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-News-component"><a href="#2-News-component" class="headerlink" title="2. News component"></a>2. News component</h3><p>we use <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/page-header/#components-page-header-demo-basic">PageHeader Basic</a> and <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/card/#components-card-demo-basic">Card Basic</a> and <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/list/#components-list-demo-simple">List Simple</a> to perform this feature.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PageHeader, Card, Col, Row, List &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">News</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [list, setList] = useState([]);</span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?publisthState=2&amp;_expand=category`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> twoDims = <span class="built_in">Object</span>.entries(_.groupBy(res.data, <span class="function"><span class="params">item</span> =&gt;</span> item.category.title));</span><br><span class="line">            <span class="comment">// console.log(twoDims);</span></span><br><span class="line">            setList(twoDims);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">width:</span> &quot;<span class="attr">95</span>%&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">margin:</span> &quot;<span class="attr">0</span> <span class="attr">auto</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="xml">        &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">PageHeader</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">className</span>=<span class="string">&quot;site-page-header&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">title</span>=<span class="string">&quot;全球大新闻&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">subTitle</span>=<span class="string">&quot;查看新闻&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;site-card-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Row</span> <span class="attr">gutter</span>=<span class="string">&#123;[16,</span> <span class="attr">16</span>]&#125;&gt;</span></span></span><br><span class="line"><span class="xml">                    &#123;</span></span><br><span class="line"><span class="xml">                        list.map(item =&gt; &#123;</span></span><br><span class="line"><span class="xml">                            return <span class="tag">&lt;<span class="name">Col</span> <span class="attr">span</span>=<span class="string">&#123;8&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item[0]&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">Card</span> <span class="attr">title</span>=<span class="string">&#123;item[0]&#125;</span> <span class="attr">bordered</span>=<span class="string">&#123;true&#125;</span> <span class="attr">hoverable</span>=<span class="string">&#123;true&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">List</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                        <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                        <span class="attr">dataSource</span>=<span class="string">&#123;item[1]&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                        <span class="attr">pagination</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                            <span class="attr">pageSize:</span> <span class="attr">3</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">                                        <span class="attr">renderItem</span>=<span class="string">&#123;data</span> =&gt;</span> <span class="tag">&lt;<span class="name">List.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#/<span class="attr">detail</span>/$&#123;<span class="attr">data.id</span>&#125;`&#125;&gt;</span>&#123;data.title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                        <span class="tag">&lt;/<span class="name">List.Item</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                                    /&gt;</span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">Col</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#125;)</span></span><br><span class="line"><span class="xml">                    &#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-Detail-component"><a href="#3-Detail-component" class="headerlink" title="3. Detail component"></a>3. Detail component</h3><p>copy from <span style="color:lightblue">src/views/sandbox/news-manage/NewsPreviews.js</span> and modify as below.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeartTwoTone &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PageHeader, Descriptions &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useParams &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Detail</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [newsInfo, setNewsInfo] = useState(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> params = useParams();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleStar = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        setNewsInfo(&#123;</span><br><span class="line">            ...newsInfo,</span><br><span class="line">            <span class="attr">star</span>: newsInfo.star + <span class="number">1</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        axios.patch(<span class="string">`/api/news/<span class="subst">$&#123;params.id&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">star</span>: newsInfo.star + <span class="number">1</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(props.match.params.id)</span></span><br><span class="line">        axios.get(<span class="string">`/api/news/<span class="subst">$&#123;params.id&#125;</span>?_expand=category&amp;_expand=role`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setNewsInfo(&#123;</span><br><span class="line">                ...res.data,</span><br><span class="line">                <span class="attr">view</span>: res.data.view + <span class="number">1</span></span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.data;</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            axios.patch(<span class="string">`/api/news/<span class="subst">$&#123;params.id&#125;</span>`</span>, &#123;</span><br><span class="line">                <span class="attr">view</span>: data.view + <span class="number">1</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, [params.id]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        newsInfo &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">PageHeader</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onBack</span>=<span class="string">&#123;()</span> =&gt;</span> window.history.back()&#125;</span></span><br><span class="line"><span class="xml">                title=&#123;newsInfo.title&#125;</span></span><br><span class="line"><span class="xml">                subTitle=&#123;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        &#123;newsInfo.category?.title&#125;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">HeartTwoTone</span> <span class="attr">twoToneColor</span>=<span class="string">&quot;#eb2f96&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> handleStar()&#125; /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Descriptions</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">column</span>=<span class="string">&#123;3&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;创建者&quot;</span>&gt;</span>&#123;newsInfo.author&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;发布时间&quot;</span>&gt;</span>&#123;newsInfo.publishTime ? moment(newsInfo.publishTime).format(&quot;YYYY/MM/DD HH:mm:ss&quot;) : &quot;-&quot;&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;区域&quot;</span>&gt;</span>&#123;newsInfo.region&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;访问数量&quot;</span>&gt;</span>&#123;newsInfo.view&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;点赞数量&quot;</span>&gt;</span>&#123;newsInfo.star&#125;<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Descriptions.Item</span> <span class="attr">label</span>=<span class="string">&quot;评论数量&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Descriptions.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Descriptions</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">PageHeader</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">__html:</span> <span class="attr">newsInfo.content</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#125;&#125; <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">margin:</span> &quot;<span class="attr">0</span> <span class="attr">24px</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">border:</span> &quot;<span class="attr">1px</span> <span class="attr">solid</span> <span class="attr">gray</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/28/npm-dashboard/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/28/npm-dashboard/" class="post-title-link" itemprop="url">news-pubish-management(8)--dashboard</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-28 17:09:10" itemprop="dateCreated datePublished" datetime="2021-12-28T17:09:10+00:00">2021-12-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>We will use <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/card/#components-card-demo-basic">Card Basic</a> and <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/list/#components-list-demo-simple">List Simple</a> to perform a dashboard in NPM system.</p>
<h3 id="1-Go-to-Home-js"><a href="#1-Go-to-Home-js" class="headerlink" title="1. Go to Home.js"></a>1. Go to Home.js</h3><p>src/views/sandbox/home/Home.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Card, Col, Row, List, Avatar &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; EditOutlined, EllipsisOutlined, SettingOutlined &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Meta &#125; = Card;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [viewList, setViewList] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [starList, setStarList] = useState([]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; username, region, <span class="attr">role</span>: &#123; roleName &#125; &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?publisthState=2&amp;_expand=category&amp;_sort=view&amp;_order=desc&amp;_limit=6`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setViewList(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?publisthState=2&amp;_expand=category&amp;_sort=star&amp;_order=desc&amp;_limit=6`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setViewList(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;site-card-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Row</span> <span class="attr">gutter</span>=<span class="string">&#123;16&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Col</span> <span class="attr">span</span>=<span class="string">&#123;8&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Card</span> <span class="attr">title</span>=<span class="string">&quot;用户最常浏览&quot;</span> <span class="attr">bordered</span>=<span class="string">&#123;true&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">List</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">dataSource</span>=<span class="string">&#123;viewList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">renderItem</span>=<span class="string">&#123;item</span> =&gt;</span> <span class="tag">&lt;<span class="name">List.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#/<span class="attr">news-manage</span>/<span class="attr">preview</span>/$&#123;<span class="attr">item.id</span>&#125;`&#125;&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">List.Item</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                        /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Col</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Col</span> <span class="attr">span</span>=<span class="string">&#123;8&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Card</span> <span class="attr">title</span>=<span class="string">&quot;用户点赞最多&quot;</span> <span class="attr">bordered</span>=<span class="string">&#123;true&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">List</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">dataSource</span>=<span class="string">&#123;starList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">renderItem</span>=<span class="string">&#123;item</span> =&gt;</span> <span class="tag">&lt;<span class="name">List.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#/<span class="attr">news-manage</span>/<span class="attr">preview</span>/$&#123;<span class="attr">item.id</span>&#125;`&#125;&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">List.Item</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                        /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Col</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Col</span> <span class="attr">span</span>=<span class="string">&#123;8&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Card</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">cover</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            &lt;<span class="attr">img</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">alt</span>=<span class="string">&quot;example&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">src</span>=<span class="string">&quot;https://gw.alipayobjects.com/zos/rmsportal/JiqGstEfoWAOHiTxclqi.png&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            /&gt;</span></span></span><br><span class="line"><span class="xml">                        &#125;</span></span><br><span class="line"><span class="xml">                        actions=&#123;[</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">SettingOutlined</span> <span class="attr">key</span>=<span class="string">&quot;setting&quot;</span> /&gt;</span>,</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">EditOutlined</span> <span class="attr">key</span>=<span class="string">&quot;edit&quot;</span> /&gt;</span>,</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">EllipsisOutlined</span> <span class="attr">key</span>=<span class="string">&quot;ellipsis&quot;</span> /&gt;</span>,</span></span><br><span class="line"><span class="xml">                        ]&#125;</span></span><br><span class="line"><span class="xml">                    &gt;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Meta</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">avatar</span>=<span class="string">&#123;</span>&lt;<span class="attr">Avatar</span> <span class="attr">src</span>=<span class="string">&quot;https://joeschmoe.io/api/v1/random&quot;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                            title=&#123;username&#125;</span></span><br><span class="line"><span class="xml">                            description=&#123;</span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;region ? region : &#x27;Global&#x27;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">paddingLeft:</span> &quot;<span class="attr">30px</span>&quot; &#125;&#125;&gt;</span>&#123;roleName&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Col</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Add-bar-pie-charts"><a href="#2-Add-bar-pie-charts" class="headerlink" title="2. Add bar/pie charts"></a>2. Add bar/pie charts</h3><p>We chose <a target="_blank" rel="noopener" href="https://github.com/apache/echarts">Echarts</a> to peform this feature.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add echarts</span><br></pre></td></tr></table></figure>
<p>Use <a target="_blank" rel="noopener" href="https://github.com/lodash/lodash">lodash</a> for manipulating data in front end</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add lodash</span><br></pre></td></tr></table></figure>
<p>add bar chart</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> barRef = useRef()</span><br><span class="line">...</span><br><span class="line">   useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?publisthState=2&amp;_expand=category`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> viewData = _.groupBy(res.data, <span class="function"><span class="params">item</span> =&gt;</span> item.category.title);</span><br><span class="line">            <span class="comment">// console.log(viewData);</span></span><br><span class="line">            renderBarView(viewData)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">window</span>.onresize = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> renderBarView = <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> option = &#123;</span><br><span class="line">            <span class="attr">title</span>: &#123;</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;新闻分类图示&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">tooltip</span>: &#123;&#125;,</span><br><span class="line">            <span class="attr">legend</span>: &#123;</span><br><span class="line">                <span class="attr">data</span>: [<span class="string">&#x27;数量&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">xAxis</span>: &#123;</span><br><span class="line">                <span class="attr">data</span>: <span class="built_in">Object</span>.keys(obj),</span><br><span class="line">                <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">                    <span class="attr">rotate</span>: <span class="string">&quot;45&quot;</span>,</span><br><span class="line">                    <span class="attr">interval</span>: <span class="number">0</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">yAxis</span>: &#123;</span><br><span class="line">                <span class="attr">minInterval</span>:<span class="number">1</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">series</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;数量&#x27;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: <span class="built_in">Object</span>.values(obj).map(<span class="function"><span class="params">item</span> =&gt;</span> item.length)</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> myChart = ECharts.init(barRef.current);</span><br><span class="line"></span><br><span class="line">        myChart.setOption(option);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">window</span>.onresize = <span class="function">() =&gt;</span>&#123;</span><br><span class="line">            myChart.resize();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&lt;div ref=&#123;barRef&#125; style=&#123;&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;100%&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;400px&#x27;</span>,</span><br><span class="line">    <span class="attr">marginTop</span>: <span class="string">&#x27;30px&#x27;</span>,</span><br><span class="line">&#125;&#125;&gt;&lt;/div&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>add pie chart<br>we use <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/drawer/#components-drawer-demo-placement">Drawer Custom Placeholder</a> for popup. It is similar to bar chart.</p>
<h3 id="3-The-Home-js-looks-like"><a href="#3-The-Home-js-looks-like" class="headerlink" title="3. The Home.js looks like:"></a>3. The Home.js looks like:</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Card, Col, Row, List, Avatar, Drawer &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; EditOutlined, EllipsisOutlined, SettingOutlined &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ECharts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Meta &#125; = Card;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [viewList, setViewList] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [starList, setStarList] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [allList, setAllList] = useState([]);</span><br><span class="line">    <span class="keyword">const</span> [drawerVisible, setDrawerVisible] = useState(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> [barChart, setBarChart] = useState(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> [pieChart, setPieChart] = useState(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> barRef = useRef();</span><br><span class="line">    <span class="keyword">const</span> pieRef = useRef();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; username, region, <span class="attr">role</span>: &#123; roleName &#125; &#125; = <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?publisthState=2&amp;_expand=category&amp;_sort=view&amp;_order=desc&amp;_limit=6`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setViewList(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?publisthState=2&amp;_expand=category&amp;_sort=star&amp;_order=desc&amp;_limit=6`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// console.log(res.data);</span></span><br><span class="line">            setViewList(res.data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">`/api/news?publisthState=2&amp;_expand=category`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            setAllList(res.data);</span><br><span class="line">            <span class="keyword">const</span> viewData = _.groupBy(res.data, <span class="function"><span class="params">item</span> =&gt;</span> item.category.title);</span><br><span class="line">            <span class="comment">// console.log(viewData);</span></span><br><span class="line">            renderBarView(viewData)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">window</span>.onresize = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> renderBarView = <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> option = &#123;</span><br><span class="line">            <span class="attr">title</span>: &#123;</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;新闻分类图示&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">tooltip</span>: &#123;&#125;,</span><br><span class="line">            <span class="attr">legend</span>: &#123;</span><br><span class="line">                <span class="attr">data</span>: [<span class="string">&#x27;数量&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">xAxis</span>: &#123;</span><br><span class="line">                <span class="attr">data</span>: <span class="built_in">Object</span>.keys(obj),</span><br><span class="line">                <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">                    <span class="attr">rotate</span>: <span class="string">&quot;45&quot;</span>,</span><br><span class="line">                    <span class="attr">interval</span>: <span class="number">0</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">yAxis</span>: &#123;</span><br><span class="line">                <span class="attr">minInterval</span>: <span class="number">1</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">series</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;数量&#x27;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: <span class="built_in">Object</span>.values(obj).map(<span class="function"><span class="params">item</span> =&gt;</span> item.length)</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> myChart;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!barChart) &#123;</span><br><span class="line">            myChart = ECharts.init(barRef.current);</span><br><span class="line">            setBarChart(myChart)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            myChart = barChart;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        myChart.setOption(option);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">window</span>.onresize = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            myChart.resize();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> renderPieView = <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> currentList = allList.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.author === username);</span><br><span class="line">        <span class="comment">// console.log(currentList);</span></span><br><span class="line">        <span class="keyword">const</span> groupObj = _.groupBy(currentList, <span class="function"><span class="params">item</span> =&gt;</span> item.category.title);</span><br><span class="line">        <span class="keyword">const</span> list = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> groupObj) &#123;</span><br><span class="line">            list.push(&#123;</span><br><span class="line">                <span class="attr">name</span>: i,</span><br><span class="line">                <span class="attr">value</span>: groupObj[i].length</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> option = &#123;</span><br><span class="line">            <span class="attr">title</span>: &#123;</span><br><span class="line">                <span class="attr">text</span>: <span class="string">`当前用户<span class="subst">$&#123;username&#125;</span>的新闻分类图示`</span>,</span><br><span class="line">                <span class="attr">left</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">tooltip</span>: &#123;</span><br><span class="line">                <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">legend</span>: &#123;</span><br><span class="line">                <span class="attr">orient</span>: <span class="string">&#x27;vertical&#x27;</span>,</span><br><span class="line">                <span class="attr">left</span>: <span class="string">&#x27;left&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">series</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;发布数量&#x27;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">                    <span class="attr">radius</span>: <span class="string">&#x27;50%&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: list,</span><br><span class="line">                    <span class="attr">emphasis</span>: &#123;</span><br><span class="line">                        <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                            <span class="attr">shadowBlur</span>: <span class="number">10</span>,</span><br><span class="line">                            <span class="attr">shadowOffsetX</span>: <span class="number">0</span>,</span><br><span class="line">                            <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> myChart</span><br><span class="line">        <span class="keyword">if</span> (!pieChart) &#123;</span><br><span class="line">            myChart = ECharts.init(pieRef.current);</span><br><span class="line">            setPieChart(myChart);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            myChart = pieChart;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        option &amp;&amp; myChart.setOption(option);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;site-card-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Row</span> <span class="attr">gutter</span>=<span class="string">&#123;16&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Col</span> <span class="attr">span</span>=<span class="string">&#123;8&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Card</span> <span class="attr">title</span>=<span class="string">&quot;用户最常浏览&quot;</span> <span class="attr">bordered</span>=<span class="string">&#123;true&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">List</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">dataSource</span>=<span class="string">&#123;viewList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">renderItem</span>=<span class="string">&#123;item</span> =&gt;</span> <span class="tag">&lt;<span class="name">List.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#/<span class="attr">news-manage</span>/<span class="attr">preview</span>/$&#123;<span class="attr">item.id</span>&#125;`&#125;&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">List.Item</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                        /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Col</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Col</span> <span class="attr">span</span>=<span class="string">&#123;8&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Card</span> <span class="attr">title</span>=<span class="string">&quot;用户点赞最多&quot;</span> <span class="attr">bordered</span>=<span class="string">&#123;true&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">List</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">dataSource</span>=<span class="string">&#123;starList&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">renderItem</span>=<span class="string">&#123;item</span> =&gt;</span> <span class="tag">&lt;<span class="name">List.Item</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#/<span class="attr">news-manage</span>/<span class="attr">preview</span>/$&#123;<span class="attr">item.id</span>&#125;`&#125;&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;/<span class="name">List.Item</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                        /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Col</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Col</span> <span class="attr">span</span>=<span class="string">&#123;8&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">Card</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                        <span class="attr">cover</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            &lt;<span class="attr">img</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">alt</span>=<span class="string">&quot;example&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                                <span class="attr">src</span>=<span class="string">&quot;https://gw.alipayobjects.com/zos/rmsportal/JiqGstEfoWAOHiTxclqi.png&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            /&gt;</span></span></span><br><span class="line"><span class="xml">                        &#125;</span></span><br><span class="line"><span class="xml">                        actions=&#123;[</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">SettingOutlined</span> <span class="attr">key</span>=<span class="string">&quot;setting&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                                setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">                                    setDrawerVisible(true);</span></span><br><span class="line"><span class="xml">                                    renderPieView();</span></span><br><span class="line"><span class="xml">                                &#125;, 0);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">                            &#125;&#125; /&gt;,</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">EditOutlined</span> <span class="attr">key</span>=<span class="string">&quot;edit&quot;</span> /&gt;</span>,</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">EllipsisOutlined</span> <span class="attr">key</span>=<span class="string">&quot;ellipsis&quot;</span> /&gt;</span>,</span></span><br><span class="line"><span class="xml">                        ]&#125;</span></span><br><span class="line"><span class="xml">                    &gt;</span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">Meta</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                            <span class="attr">avatar</span>=<span class="string">&#123;</span>&lt;<span class="attr">Avatar</span> <span class="attr">src</span>=<span class="string">&quot;https://joeschmoe.io/api/v1/random&quot;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">                            title=&#123;username&#125;</span></span><br><span class="line"><span class="xml">                            description=&#123;</span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;region ? region : &#x27;Global&#x27;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">paddingLeft:</span> &quot;<span class="attr">30px</span>&quot; &#125;&#125;&gt;</span>&#123;roleName&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                            &#125;</span></span><br><span class="line"><span class="xml">                        /&gt;</span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">Card</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">Col</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;barRef&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">height:</span> &#x27;<span class="attr">400px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">marginTop:</span> &#x27;<span class="attr">30px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Drawer</span> <span class="attr">title</span>=<span class="string">&quot;个人新闻分类&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">width</span>=<span class="string">&#x27;500px&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">placement</span>=<span class="string">&quot;right&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">closable</span>=<span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onClose</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">                    setDrawerVisible(false)</span></span><br><span class="line"><span class="xml">                &#125;&#125;</span></span><br><span class="line"><span class="xml">                visible=&#123;drawerVisible&#125;&gt;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;pieRef&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">height:</span> &#x27;<span class="attr">400px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                    <span class="attr">marginTop:</span> &#x27;<span class="attr">30px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="xml">                &#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Drawer</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/12/28/npm-state-with-redux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Nate Liu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nate Liu's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/28/npm-state-with-redux/" class="post-title-link" itemprop="url">news-pubish-management(7)--manage state with redux</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-28 14:11:22" itemprop="dateCreated datePublished" datetime="2021-12-28T14:11:22+00:00">2021-12-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 09:06:01" itemprop="dateModified" datetime="2022-01-23T09:06:01+00:00">2022-01-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Next we focus on the state management, here we use classic <a target="_blank" rel="noopener" href="https://redux.js.org/">Redux</a>.</p>
<h3 id="1-setup-redux"><a href="#1-setup-redux" class="headerlink" title="1. setup redux"></a>1. setup redux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn add redux react-redux</span><br><span class="line">mkdir src/redux</span><br><span class="line">touch src/redux/store.js</span><br><span class="line">mkdir src/redux/reducers</span><br><span class="line">touch src/redux/reducers/CollapsedReducer.js</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://redux.js.org/understanding/thinking-in-redux/three-principles">redux principles</a><br> . Single source of truth<br> . State is read-only<br> . Changes are made with pure functions</p>
</blockquote>
<h3 id="2-Finish-the-collapsed-in-both-TopHeader-and-SideMenu-components"><a href="#2-Finish-the-collapsed-in-both-TopHeader-and-SideMenu-components" class="headerlink" title="2. Finish the collapsed in both TopHeader and SideMenu components."></a>2. Finish the collapsed in both <code>TopHeader</code> and <code>SideMenu</code> components.</h3><p>CollapsedReducer.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CollapsedReducer = <span class="function">(<span class="params">prevState = &#123; isCollapsed: <span class="literal">false</span> &#125;, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> prevState;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CollapsedReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;./reducers/CollapsedReducer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">    CollapsedReducer</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>we have a single store now, it mean if we can get back our store, then we can do store.dispatch or store.subscribe operations. but how to get store in our component?<br>Go to App.js, make our IndexRouter in the Provider section.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> IndexRouter <span class="keyword">from</span> <span class="string">&#x27;./router/IndexRouter&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./redux/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">IndexRouter</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Our <code>SideMenu</code> and <code>TopHeader</code> will use the store. so go to <code>TopHeader</code> first, because <code>Topheader</code> is publish the state.Its response is <code>Dispatch</code> the state to store.<br>In <code>TopHeader</code>, we use <code>connect</code> to make <code>TopHeader</code> as child components, we can get value from parameter of <code>props</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TopHeader</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">testValue</span>:<span class="string">&#x27;testValue&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(TopHeader);</span><br></pre></td></tr></table></figure>
<p>In previous version, we use component’s state, now we have props. and props contain isCollapsed, so we remove the component state.</p>
<figure class="highlight javascript"><figcaption><span>in TopHeader</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TopHeader</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> changed to redux, state is not neccessary.</span></span><br><span class="line">    <span class="comment">// const [collapsed, setCollapsed] = useState(false)</span></span><br><span class="line">  ...</span><br><span class="line">    <span class="keyword">const</span> changeCollapsed = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> changed to redux, state is not neccessary.</span></span><br><span class="line">    <span class="comment">// setCollapsed(!collapsed);</span></span><br><span class="line">    props.changeCollapsed();</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">&#123; CollapsedReducer: &#123; isCollapsed &#125; &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    isCollapsed</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = &#123;</span><br><span class="line">  <span class="function"><span class="title">changeCollapsed</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;change_collapsed&quot;</span>,</span><br><span class="line">      <span class="comment">// payload:&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(TopHeader);</span><br></pre></td></tr></table></figure>
<p>when user click the icon in <code>TopHeader</code>, the workflow go to <code>store</code>, and <code>store</code> find out the <code>CollapsedReducer</code>, then excute the logic to change to new state. below are the <code>CollapsedReducer.js</code> content:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CollapsedReducer = <span class="function">(<span class="params">prevState = &#123; isCollapsed: <span class="literal">false</span> &#125;, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(action);</span></span><br><span class="line">    <span class="keyword">const</span> &#123; type &#125; = action;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;change_collapsed&#x27;</span>:</span><br><span class="line">            <span class="keyword">let</span> newState = &#123; ...prevState &#125;;</span><br><span class="line">            newState.isCollapsed = !newState.isCollapsed;</span><br><span class="line">            <span class="keyword">return</span> newState;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> prevState;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Back to <code>SideMedu</code>, <code>SideMenu</code> retrieve the state to collapse or expand himself. We also <code>connect</code> <code>SideMenu </code>first. It doesn’t need <code>Dispatch</code> anything, so our changing in <code>SideMenu</code> looks like:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SideMenu</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    &lt;Sider trigger=&#123;<span class="literal">null</span>&#125; collapsible collapsed=&#123;props.isCollapsed&#125;&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">&#123; CollapsedReducer: &#123; isCollapsed &#125; &#125;</span>) =&gt;</span> (&#123; isCollapsed &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(SideMenu);</span><br></pre></td></tr></table></figure>









<h3 id="3-Add-spin-when-retrieve-data-from-backend-db"><a href="#3-Add-spin-when-retrieve-data-from-backend-db" class="headerlink" title="3. Add spin when retrieve data from backend db."></a>3. Add <a target="_blank" rel="noopener" href="https://ant-design.gitee.io/components/spin-cn/#header">spin</a> when retrieve data from backend db.</h3><p>Go to NewsRouter.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Spin &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Spin</span> <span class="attr">size</span>=<span class="string">&#x27;large&#x27;</span> <span class="attr">spinning</span>=<span class="string">&#123;true&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        ...</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Spin</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>if the spinning is false then the Spin is displayed, otherwise will showing.</p>
<p>every call will showing, we can perform it in <a target="_blank" rel="noopener" href="https://axios-http.com/docs/interceptors">axios intercepter</a>.</p>
<p>Go to http.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Add a request interceptor</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something before request is sent</span></span><br><span class="line">    <span class="comment">// Show Spin</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something with request error</span></span><br><span class="line">    <span class="comment">// Hide Spin</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a response interceptor</span></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Any status code that lie within the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response data</span></span><br><span class="line">    <span class="comment">// Hide Spin</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Any status codes that falls outside the range of 2xx cause this function to trigger</span></span><br><span class="line">    <span class="comment">// Do something with response error</span></span><br><span class="line">    <span class="comment">// Hide Spin</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch src/redux/reducers/LoadingReducer.js</span><br></pre></td></tr></table></figure>
<p>copy CollapsedReducer.js and modified as below</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> LoadingReducer = <span class="function">(<span class="params">prevState = &#123; isLoading: <span class="literal">false</span> &#125;, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(action);</span></span><br><span class="line">    <span class="keyword">const</span> &#123; type, payload &#125; = action;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;change_loading&#x27;</span>:</span><br><span class="line">            <span class="keyword">let</span> newState = &#123; ...prevState &#125;;</span><br><span class="line">            newState.isLoading = payload;</span><br><span class="line">            <span class="keyword">return</span> newState;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> prevState;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>also we need login this reducer to store.js.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CollapsedReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;./reducers/CollapsedReducer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LoadingReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;./reducers/LoadingReducer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">    CollapsedReducer,</span><br><span class="line">    LoadingReducer</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>add connect to NewsRouter.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NewsRouter</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    &lt;Spin size=<span class="string">&#x27;large&#x27;</span> spinning=&#123;props.isLoading&#125;&gt;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">&#123; LoadingReducer: &#123; isLoading &#125; &#125;</span>) =&gt;</span> (&#123; isLoading &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(NewsRouter);</span><br></pre></td></tr></table></figure>
<p>Back to http.js to dispatch isLoading to store.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;../redux/store&#x27;</span>;</span><br><span class="line">...</span><br><span class="line">    store.dispatch(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&#x27;change_loading&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>


<h3 id="4-Persist-redux-state"><a href="#4-Persist-redux-state" class="headerlink" title="4. Persist redux state"></a>4. Persist redux state</h3><p>We chose <a target="_blank" rel="noopener" href="https://github.com/rt2zz/redux-persist">redux persist</a> to implement this feature.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add redux-persist</span><br></pre></td></tr></table></figure>
<p>we have to modify our store.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CollapsedReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;./reducers/CollapsedReducer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LoadingReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;./reducers/LoadingReducer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; persistStore, persistReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-persist&#x27;</span></span><br><span class="line"><span class="keyword">import</span> storage <span class="keyword">from</span> <span class="string">&#x27;redux-persist/lib/storage&#x27;</span> <span class="comment">// defaults to localStorage for web</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = combineReducers(&#123;</span><br><span class="line">    CollapsedReducer,</span><br><span class="line">    LoadingReducer</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> persistConfig = &#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;collapsed&#x27;</span>,</span><br><span class="line">    storage,</span><br><span class="line">    <span class="attr">blacklist</span>: [<span class="string">&#x27;LoadingReducer&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> persistedReducer = persistReducer(persistConfig, reducer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(persistedReducer)</span><br><span class="line"><span class="keyword">const</span> persistor = persistStore(store)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    store,</span><br><span class="line">    persistor,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Go to App.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; store, persistor &#125; <span class="keyword">from</span> <span class="string">&#x27;./redux/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; PersistGate &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-persist/integration/react&#x27;</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">PersistGate</span> <span class="attr">loading</span>=<span class="string">&#123;null&#125;</span> <span class="attr">persistor</span>=<span class="string">&#123;persistor&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        ...</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">PersistGate</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nate Liu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
